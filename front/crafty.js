(function(b,r,t){function y(){var c=a++;return c in e?y():c}function x(a){if(null===a||"object"!=typeof a)return a;var c=a.constructor(),b;for(b in a)c[b]=x(a[b]);return c}var s=function(a){return new s.fn.init(a)},a,c,d,f,e,g,h,n,k,m,p,q,A,v,w,z=function(){a=1;c=50;d=1;f={};e={};entityFactories={};g={};h;n;k;m=0;p=1E3/c;q=(new Date).getTime();A=Array.prototype.slice;v=/\s*,\s*/;w=/\s+/};z();s.fn=s.prototype={init:function(a){if("string"===typeof a){var c=0,b,d,g=!1,h=!1,k,m,n,p,q;if("*"===a){for(b in e)this[+b]=
e[b],c++;this.length=c;return this}-1!==a.indexOf(",")?(h=!0,k=v):-1!==a.indexOf(" ")&&(g=!0,k=w);for(b in e)if(e.hasOwnProperty(b))if(d=e[b],g||h){m=a.split(k);p=0;q=m.length;for(n=0;p<q;p++)d.__c[m[p]]&&n++;if(g&&n===q||h&&0<n)this[c++]=+b}else d.__c[a]&&(this[c++]=+b);0<c&&!g&&!h&&this.extend(f[a]);if(m&&g)for(p=0;p<q;p++)this.extend(f[m[p]]);this.length=c;if(1===c)return e[this[c-1]]}else{a||(a=0,a in e||(e[a]=this));if(!(a in e))return this.length=0,this;this[0]=a;this.length=1;this.__c||(this.__c=
{});e[a]||(e[a]=this);return e[a]}return this},setName:function(a){this._entityName=a=String(a);this.trigger("NewEntityName",a);return this},addComponent:function(a){var c=[],b=0,d;d=0;var e,g;if(1<arguments.length)for(e=arguments.length;d<e;d++)this.__c[arguments[d]]=!0,c.push(arguments[d]);else if(-1!==a.indexOf(","))for(g=a.split(v),e=g.length;d<e;d++)this.__c[g[d]]=!0,c.push(g[d]);else this.__c[a]=!0,c.push(a);for(d=c.length;b<d;b++)comp=f[c[b]],this.extend(comp),comp&&"init"in comp&&comp.init.call(this);
this.trigger("NewComponent",d);return this},toggleComponent:function(a){var c=0,b,d;if(1<arguments.length)for(b=arguments.length;c<b;c++)this.has(arguments[c])?this.removeComponent(arguments[c]):this.addComponent(arguments[c]);else if(-1!==a.indexOf(","))for(d=a.split(v),b=d.length;c<b;c++)this.has(d[c])?this.removeComponent(d[c]):this.addComponent(d[c]);else this.has(a)?this.removeComponent(a):this.addComponent(a);return this},requires:function(a){a=a.split(v);for(var c=0,b=a.length,d;c<b;++c)d=
a[c],this.has(d)||this.addComponent(d);return this},removeComponent:function(a,c){if(!1===c){var d=f[a],b;for(b in d)delete this[b]}delete this.__c[a];this.trigger("RemoveComponent",a);return this},has:function(a){return!!this.__c[a]},attr:function(a,c){if(1===arguments.length){if("string"===typeof a)return this[a];this.extend(a);this.trigger("Change",a);return this}this[a]=c;var b={};b[a]=c;this.trigger("Change",b);return this},toArray:function(){return A.call(this,0)},timeout:function(a,c){this.each(function(){var b=
this;setTimeout(function(){a.call(b)},c)});return this},bind:function(a,c){if(1===this.length){g[a]||(g[a]={});var b=g[a];b[this[0]]||(b[this[0]]=[]);b[this[0]].push(c);return this}this.each(function(){g[a]||(g[a]={});var b=g[a];b[this[0]]||(b[this[0]]=[]);b[this[0]].push(c)});return this},unbind:function(a,c){this.each(function(){var b=g[a],d=0,e,f;if(b&&b[this[0]])e=b[this[0]].length;else return this;if(!c)return delete b[this[0]],this;for(;d<e;d++)f=b[this[0]],f[d]==c&&(f.splice(d,1),d--)});return this},
trigger:function(a,c){if(1===this.length){if(g[a]&&g[a][this[0]])for(var b=g[a][this[0]],d=0,e=b.length;d<e;d++)b[d].call(this,c);return this}this.each(function(){if(g[a]&&g[a][this[0]])for(var b=g[a][this[0]],d=0,e=b.length;d<e;d++)b[d].call(this,c)});return this},each:function(a){for(var c=0,b=this.length;c<b;c++)e[this[c]]&&a.call(e[this[c]],c);return this},clone:function(){var a=this.__c,c,b,d=s.e();for(c in a)d.addComponent(c);for(b in this)"0"!=b&&"_global"!=b&&"_changed"!=b&&"function"!=typeof this[b]&&
"object"!=typeof this[b]&&(d[b]=this[b]);return d},setter:function(a,c){s.support.setter?this.__defineSetter__(a,c):s.support.defineProperty?Object.defineProperty(this,a,{set:c,configurable:!0}):k.push({prop:a,obj:this,fn:c});return this},destroy:function(){this.each(function(){this.trigger("Remove");for(var a in g)this.unbind(a);delete e[this[0]]})}};s.fn.init.prototype=s.fn;s.extend=s.fn.extend=function(a){var c;if(!a)return this;for(c in a)this!==a[c]&&(this[c]=a[c]);return this};s.extend({init:function(a,
c){s.viewport.init(a,c);this.trigger("Load");this.timer.init();return this},getVersion:function(){return"0.5.3"},stop:function(a){this.timer.stop();a&&(s.stage&&s.stage.elem.parentNode&&(a=document.createElement("div"),a.id="cr-stage",s.stage.elem.parentNode.replaceChild(a,s.stage.elem)),z(),r(s,b,b.document));s.trigger("CraftyStop");return this},pause:function(a){(1==arguments.length?a:!this._paused)?(this.trigger("Pause"),this._paused=!0,setTimeout(function(){s.timer.stop()},0),s.keydown={}):(this.trigger("Unpause"),
this._paused=!1,setTimeout(function(){s.timer.init()},0));return this},isPaused:function(){return this._paused},timer:{prev:+new Date,current:+new Date,currentTime:+new Date,frames:0,frameTime:0,init:function(){var a=b.requestAnimationFrame||b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame||b.oRequestAnimationFrame||b.msRequestAnimationFrame||null;a?(h=function(){s.timer.step();n=a(h)},h()):h=setInterval(function(){s.timer.step()},1E3/c)},stop:function(){s.trigger("CraftyStopTimer");"number"===
typeof h&&clearInterval(h);var a=b.cancelRequestAnimationFrame||b.webkitCancelRequestAnimationFrame||b.mozCancelRequestAnimationFrame||b.oCancelRequestAnimationFrame||b.msCancelRequestAnimationFrame||null;a&&a(n);h=null},step:function(){m=0;this.currentTime=+new Date;for(this.currentTime-q>60*p&&(q=this.currentTime-p);this.currentTime>q;)s.trigger("EnterFrame",{frame:d++}),q+=p,m++;m&&s.DrawManager.draw();this.currentTime>this.frameTime?(s.trigger("MessureFPS",{value:this.frame}),this.frame=0,this.frameTime=
this.currentTime+1E3):this.frame++},getFPS:function(){return c},simulateFrames:function(a){for(;0<a--;)s.trigger("EnterFrame",{frame:d++});s.DrawManager.draw()}},addEntityFactory:function(a,c){this.entityFactories[a]=c},newFactoryEntity:function(a){return this.entityTemplates[a]()},e:function(){var a=y(),c;e[a]=null;e[a]=c=s(a);0<arguments.length&&c.addComponent.apply(c,arguments);c.setName("Entity #"+a);c.addComponent("obj");s.trigger("NewEntity",{id:a});return c},c:function(a,c){f[a]=c},trigger:function(a,
c){var b=g[a],d,f,h;for(d in b)if(b.hasOwnProperty(d))for(f=0,h=b[d].length;f<h;f++)b[d]&&b[d][f]&&(e[d]?b[d][f].call(s(+d),c):b[d][f].call(s,c))},bind:function(a,c){g[a]||(g[a]={});var b=g[a];b.global||(b.global=[]);return b.global.push(c)-1},unbind:function(a,c){var b=g[a],d,e,f;for(d in b)if(b.hasOwnProperty(d)){if("number"===typeof c)return delete b[d][c],!0;e=0;for(f=b[d].length;e<f;e++)if(b[d][e]===c)return delete b[d][e],!0}return!1},frame:function(){return d},components:function(){return f},
isComp:function(a){return a in f},debug:function(){return e},settings:function(){var a={},c={};return{register:function(a,b){c[a]=b},modify:function(b,d){c[b]&&(c[b].call(a[b],d),a[b]=d)},get:function(c){return a[c]}}}(),clone:x});s.bind("Load",function(){!s.support.setter&&s.support.defineProperty&&(k=[],s.bind("EnterFrame",function(){for(var a=0,c=k.length,b;a<c;++a)b=k[a],b.obj[b.prop]!==b.obj["_"+b.prop]&&b.fn.call(b.obj,b.obj[b.prop])}))});r(s,b,b.document);b.Crafty=s;"function"===typeof define&&
define("crafty",[],function(){return s})})(window,function(b,r,t){function y(a){if(!(0>=this._numProps)){for(var c in this._step)a=this._step[c],this[c]+=a.val,0==--a.rem&&(this[c]=a.prop,this.trigger("TweenEnd",c),0>=this._step[c].rem&&delete this._step[c],this._numProps--);this.has("Mouse")&&(c=b.over,a=b.mousePos,c&&c[0]==this[0]&&!this.isAt(a.x,a.y)?(this.trigger("MouseOut",b.lastEvent),b.over=null):c&&c[0]==this[0]||!this.isAt(a.x,a.y)||(b.over=this,this.trigger("MouseOver",b.lastEvent)))}}(function(a){function c(a,
c,b){this.keys=a;this.map=b;this.obj=c}var b,f=function(a){b=a||64;this.map={}};f.prototype={insert:function(a){for(var b=f.key(a),d=new c(b,a,this),n=0,k,m,n=b.x1;n<=b.x2;n++)for(k=b.y1;k<=b.y2;k++)m=n+" "+k,this.map[m]||(this.map[m]=[]),this.map[m].push(a);return d},search:function(a,c){var b=f.key(a),d,k,m,p=[];void 0===c&&(c=!0);for(d=b.x1;d<=b.x2;d++)for(k=b.y1;k<=b.y2;k++)m=d+" "+k,this.map[m]&&(p=p.concat(this.map[m]));if(c){var q;k=[];m={};d=0;for(l=p.length;d<l;d++)if(q=p[d])b=q[0],!m[b]&&
q.x<a._x+a._w&&q._x+q._w>a._x&&q.y<a._y+a._h&&q._h+q._y>a._y&&(m[b]=p[d]);for(q in m)k.push(m[q]);return k}return p},remove:function(a,c){var b=0,d,k;1==arguments.length&&(c=a,a=f.key(c));for(b=a.x1;b<=a.x2;b++)for(d=a.y1;d<=a.y2;d++)if(k=b+" "+d,this.map[k]){k=this.map[k];var m,p=k.length;for(m=0;m<p;m++)k[m]&&k[m][0]===c[0]&&k.splice(m,1)}},boundaries:function(){var a,c,b=-Infinity,d=-Infinity,f=Infinity,m=Infinity,p={max:{x:-Infinity,y:-Infinity},min:{x:Infinity,y:Infinity}},q;for(q in this.map)if(this.map[q].length){c=
q.split(" ");var r=c[0],s=c[0];if(r>=b)for(a in b=r,this.map[q])c=this.map[q][a],"object"==typeof c&&"requires"in c&&(p.max.x=Math.max(p.max.x,c.x+c.w));if(r<=f)for(a in f=r,this.map[q])c=this.map[q][a],"object"==typeof c&&"requires"in c&&(p.min.x=Math.min(p.min.x,c.x));if(s>=d)for(a in d=s,this.map[q])c=this.map[q][a],"object"==typeof c&&"requires"in c&&(p.max.y=Math.max(p.max.y,c.y+c.h));if(s<=m)for(a in m=s,this.map[q])c=this.map[q][a],"object"==typeof c&&"requires"in c&&(p.min.y=Math.min(p.min.y,
c.y))}return p}};f.key=function(a){a.hasOwnProperty("mbr")&&(a=a.mbr());return{x1:Math.floor(a._x/b),y1:Math.floor(a._y/b),x2:Math.floor((a._w+a._x)/b),y2:Math.floor((a._h+a._y)/b)}};f.hash=function(a){return a.x1+" "+a.y1+" "+a.x2+" "+a.y2};c.prototype={update:function(a){f.hash(f.key(a))!=f.hash(this.keys)&&(this.map.remove(this.keys,this.obj),this.keys=this.map.insert(this.obj).keys)}};a.HashMap=f})(b);b.map=new b.HashMap;var x=Math.PI/180;b.c("2D",{_x:0,_y:0,_w:0,_h:0,_z:0,_rotation:0,_alpha:1,
_visible:!0,_globalZ:null,_origin:null,_mbr:null,_entry:null,_children:null,_parent:null,_changed:!1,_defineGetterSetter_setter:function(){this.__defineSetter__("x",function(a){this._attr("_x",a)});this.__defineSetter__("y",function(a){this._attr("_y",a)});this.__defineSetter__("w",function(a){this._attr("_w",a)});this.__defineSetter__("h",function(a){this._attr("_h",a)});this.__defineSetter__("z",function(a){this._attr("_z",a)});this.__defineSetter__("rotation",function(a){this._attr("_rotation",
a)});this.__defineSetter__("alpha",function(a){this._attr("_alpha",a)});this.__defineSetter__("visible",function(a){this._attr("_visible",a)});this.__defineGetter__("x",function(){return this._x});this.__defineGetter__("y",function(){return this._y});this.__defineGetter__("w",function(){return this._w});this.__defineGetter__("h",function(){return this._h});this.__defineGetter__("z",function(){return this._z});this.__defineGetter__("rotation",function(){return this._rotation});this.__defineGetter__("alpha",
function(){return this._alpha});this.__defineGetter__("visible",function(){return this._visible});this.__defineGetter__("parent",function(){return this._parent});this.__defineGetter__("numChildren",function(){return this._children.length})},_defineGetterSetter_defineProperty:function(){Object.defineProperty(this,"x",{set:function(a){this._attr("_x",a)},get:function(){return this._x},configurable:!0});Object.defineProperty(this,"y",{set:function(a){this._attr("_y",a)},get:function(){return this._y},
configurable:!0});Object.defineProperty(this,"w",{set:function(a){this._attr("_w",a)},get:function(){return this._w},configurable:!0});Object.defineProperty(this,"h",{set:function(a){this._attr("_h",a)},get:function(){return this._h},configurable:!0});Object.defineProperty(this,"z",{set:function(a){this._attr("_z",a)},get:function(){return this._z},configurable:!0});Object.defineProperty(this,"rotation",{set:function(a){this._attr("_rotation",a)},get:function(){return this._rotation},configurable:!0});
Object.defineProperty(this,"alpha",{set:function(a){this._attr("_alpha",a)},get:function(){return this._alpha},configurable:!0});Object.defineProperty(this,"visible",{set:function(a){this._attr("_visible",a)},get:function(){return this._visible},configurable:!0})},_defineGetterSetter_fallback:function(){this.x=this._x;this.y=this._y;this.w=this._w;this.h=this._h;this.z=this._z;this.rotation=this._rotation;this.alpha=this._alpha;this.visible=this._visible;this.bind("EnterFrame",function(){if(this.x!==
this._x||this.y!==this._y||this.w!==this._w||this.h!==this._h||this.z!==this._z||this.rotation!==this._rotation||this.alpha!==this._alpha||this.visible!==this._visible){var a=this.mbr()||this.pos();if(this.rotation!==this._rotation)this._rotate(this.rotation);else{var c=this._mbr,b=!1;c&&(this.x!==this._x?(c._x-=this.x-this._x,b=!0):this.y!==this._y?(c._y-=this.y-this._y,b=!0):this.w!==this._w?(c._w-=this.w-this._w,b=!0):this.h!==this._h?(c._h-=this.h-this._h,b=!0):this.z!==this._z&&(c._z-=this.z-
this._z,b=!0));b&&this.trigger("Move",a)}this._x=this.x;this._y=this.y;this._w=this.w;this._h=this.h;this._z=this.z;this._rotation=this.rotation;this._alpha=this.alpha;this._visible=this.visible;this.trigger("Change",a);this.trigger("Move",a)}})},init:function(){this._globalZ=this[0];this._origin={x:0,y:0};this._children=[];b.support.setter?this._defineGetterSetter_setter():b.support.defineProperty?this._defineGetterSetter_defineProperty():this._defineGetterSetter_fallback();this._entry=b.map.insert(this);
this.bind("Move",function(a){this._entry.update(this._mbr||this);this._cascade(a)});this.bind("Rotate",function(a){this._entry.update(this._mbr||this);this._cascade(a)});this.bind("Remove",function(){if(this._children){for(var a=0;a<this._children.length;a++)this._children[a].destroy&&this._children[a].destroy();this._children=[]}this._parent&&this._parent.detach(this);b.map.remove(this);this.detach()})},_rotate:function(a){var c=a%360*-1,b=c*x,f=Math.cos(b),b=Math.sin(b),e=this._origin.x+this._x,
g=this._origin.y+this._y;if(!c&&(this._mbr=null,!this._rotation%360))return;var h=e+(this._x-e)*f+(this._y-g)*b,n=g-(this._x-e)*b+(this._y-g)*f,k=e+(this._x+this._w-e)*f+(this._y-g)*b,m=g-(this._x+this._w-e)*b+(this._y-g)*f,p=e+(this._x+this._w-e)*f+(this._y+this._h-g)*b,q=g-(this._x+this._w-e)*b+(this._y+this._h-g)*f,r=e+(this._x-e)*f+(this._y+this._h-g)*b,s=g-(this._x-e)*b+(this._y+this._h-g)*f,c=Math.round(Math.min(h,k,p,r)),w=Math.round(Math.min(n,m,q,s)),h=Math.round(Math.max(h,k,p,r)),n=Math.round(Math.max(n,
m,q,s));this._mbr={_x:c,_y:w,_w:h-c,_h:n-w};a=this._rotation-a;c=a*x;this.trigger("Rotate",{cos:Math.cos(c),sin:Math.sin(c),deg:a,rad:c,o:{x:e,y:g},matrix:{M11:f,M12:b,M21:-b,M22:f}})},area:function(){return this._w*this._h},intersect:function(a,c,b,f){var e=this._mbr||this;a="object"===typeof a?a:{x:a,y:c,w:b,h:f};return e._x<a.x+a.w&&e._x+e._w>a.x&&e._y<a.y+a.h&&e._h+e._y>a.y},within:function(a,c,b,f){a="object"===typeof a?a:{x:a,y:c,w:b,h:f};return a.x<=this.x&&a.x+a.w>=this.x+this.w&&a.y<=this.y&&
a.y+a.h>=this.y+this.h},contains:function(a,c,b,f){a="object"===typeof a?a:{x:a,y:c,w:b,h:f};return a.x>=this.x&&a.x+a.w<=this.x+this.w&&a.y>=this.y&&a.y+a.h<=this.y+this.h},pos:function(){return{_x:this._x,_y:this._y,_w:this._w,_h:this._h}},mbr:function(){return this._mbr?{_x:this._mbr._x,_y:this._mbr._y,_w:this._mbr._w,_h:this._mbr._h}:this.pos()},isAt:function(a,c){return this.mapArea?this.mapArea.containsPoint(a,c):this.map?this.map.containsPoint(a,c):this.x<=a&&this.x+this.w>=a&&this.y<=c&&this.y+
this.h>=c},move:function(a,c){"n"===a.charAt(0)&&(this.y-=c);"s"===a.charAt(0)&&(this.y+=c);if("e"===a||"e"===a.charAt(1))this.x+=c;if("w"===a||"w"===a.charAt(1))this.x-=c;return this},shift:function(a,c,b,f){a&&(this.x+=a);c&&(this.y+=c);b&&(this.w+=b);f&&(this.h+=f);return this},_cascade:function(a){if(a){var c=0,b=this._children,f=b.length,e;if(a.cos)for(;c<f;++c)e=b[c],"rotate"in e&&e.rotate(a);else{e=this._mbr||this;var g=e._x-a._x,h=e._y-a._y,n=e._w-a._w;for(a=e._h-a._h;c<f;++c)e=b[c],e.shift(g,
h,n,a)}}},attach:function(){for(var a=0,c=arguments,b=arguments.length,f;a<b;++a)f=c[a],f._parent&&f._parent.detach(f),f._parent=this,this._children.push(f);return this},detach:function(a){if(!a){for(var c=0;c<this._children.length;c++)this._children[c]._parent=null;this._children=[];return this}for(c=0;c<this._children.length;c++)this._children[c]==a&&this._children.splice(c,1);a._parent=null;return this},origin:function(a,c){if("string"===typeof a)if("centre"===a||"center"===a||-1===a.indexOf(" "))a=
this._w/2,c=this._h/2;else{var b=a.split(" ");if("top"===b[0])c=0;else if("bottom"===b[0])c=this._h;else if("middle"===b[0]||"center"===b[1]||"centre"===b[1])c=this._h/2;"center"===b[1]||"centre"===b[1]||"middle"===b[1]?a=this._w/2:"left"===b[1]?a=0:"right"===b[1]&&(a=this._w)}this._origin.x=a;this._origin.y=c;return this},flip:function(a){a=a||"X";this["_flip"+a]||(this["_flip"+a]=!0,this.trigger("Change"))},unflip:function(a){a=a||"X";this["_flip"+a]&&(this["_flip"+a]=!1,this.trigger("Change"))},
rotate:function(a){this._origin.x=a.o.x-this._x;this._origin.y=a.o.y-this._y;this._attr("_rotation",a.theta)},_attr:function(a,c){var d=this.pos(),d=this.mbr()||d;if("_rotation"===a)this._rotate(c),this.trigger("Rotate");else if("_z"===a)this._globalZ=parseInt(c+b.zeroFill(this[0],5),10),this.trigger("reorder");else if("_x"==a||"_y"===a||"_w"===a||"_h"===a){var f=this._mbr;f&&(f[a]-=this[a]-c);this[a]=c;this.trigger("Move",d)}this[a]=c;this.trigger("Change",d)}});b.c("Physics",{_gravity:.4,_friction:.2,
_bounce:.5,gravity:function(a){this._gravity=a}});b.c("Gravity",{_gravityConst:.2,_gy:0,_falling:!0,_anti:null,init:function(){this.requires("2D")},gravity:function(a){a&&(this._anti=a);this.bind("EnterFrame",this._enterFrame);return this},gravityConst:function(a){this._gravityConst=a;return this},_enterFrame:function(){this._falling?(this._gy+=this._gravityConst,this.y+=this._gy):this._gy=0;var a,c=!1,d=this.pos(),f,e=0,g;d._y++;d.x=d._x;d.y=d._y;d.w=d._w;d.h=d._h;f=b.map.search(d);for(g=f.length;e<
g;++e)if(a=f[e],a!==this&&a.has(this._anti)&&a.intersect(d)){c=a;break}c?this._falling&&this.stopFalling(c):this._falling=!0},stopFalling:function(a){a&&(this.y=a._y-this._h);this._falling=!1;this._up&&(this._up=!1);this.trigger("hit")},antigravity:function(){this.unbind("EnterFrame",this._enterFrame)}});b.polygon=function(a){1<arguments.length&&(a=Array.prototype.slice.call(arguments,0));this.points=a};b.polygon.prototype={containsPoint:function(a,c){var b=this.points,f,e,g=!1;f=0;for(e=b.length-
1;f<b.length;e=f++)b[f][1]>c!=b[e][1]>c&&a<(b[e][0]-b[f][0])*(c-b[f][1])/(b[e][1]-b[f][1])+b[f][0]&&(g=!g);return g},shift:function(a,c){for(var b=0,f=this.points.length,e;b<f;b++)e=this.points[b],e[0]+=a,e[1]+=c},rotate:function(a){for(var c=0,b=this.points.length,f,e,g;c<b;c++)f=this.points[c],e=a.o.x+(f[0]-a.o.x)*a.cos+(f[1]-a.o.y)*a.sin,g=a.o.y-(f[0]-a.o.x)*a.sin+(f[1]-a.o.y)*a.cos,f[0]=e,f[1]=g}};b.circle=function(a,c,b){this.x=a;this.y=c;this.radius=b;this.points=[];for(c=0;8>c;c++)a=c*Math.PI/
4,this.points[c]=[this.x+Math.sin(a)*b,this.y+Math.cos(a)*b]};b.circle.prototype={containsPoint:function(a,c){var b=this.radius,f=this.x-a,e=this.y-c;return f*f+e*e<b*b},shift:function(a,c){this.x+=a;this.y+=c;for(var b=0,f=this.points.length,e;b<f;b++)e=this.points[b],e[0]+=a,e[1]+=c},rotate:function(){}};b.matrix=function(a){this.mtx=a;this.width=a[0].length;this.height=a.length};b.matrix.prototype={x:function(a){if(this.width==a.height){for(var c=[],d=0;d<this.height;d++){c[d]=[];for(var f=0;f<
a.width;f++){for(var e=0,g=0;g<this.width;g++)e+=this.mtx[d][g]*a.mtx[g][f];c[d][f]=e}}return new b.matrix(c)}},e:function(a,c){return 1>a||a>this.mtx.length||1>c||c>this.mtx[0].length?null:this.mtx[a-1][c-1]}};b.c("Collision",{init:function(){this.requires("2D");var a=this._mbr||this;this.map=poly=new b.polygon([0,0],[a._w,0],[a._w,a._h],[0,a._h]);this.attach(this.map);this.map.shift(a._x,a._y)},collision:function(a){var c=this._mbr||this;a||(a=new b.polygon([0,0],[c._w,0],[c._w,c._h],[0,c._h]));
if(1<arguments.length){var d=Array.prototype.slice.call(arguments,0);a=new b.polygon(d)}this.map=a;this.attach(this.map);this.map.shift(c._x,c._y);return this},hit:function(a){var c=this._mbr||this,d=b.map.search(c,!1),f=0,e=d.length,g={},h,n,k,m,p="map"in this&&"containsPoint"in this.map,q=[];if(!e)return!1;for(;f<e;++f)n=d[f],k=n._mbr||n,n&&(h=n[0],!g[h]&&this[0]!==h&&n.__c[a]&&k._x<c._x+c._w&&k._x+k._w>c._x&&k._y<c._y+c._h&&k._h+k._y>c._y&&(g[h]=n));for(m in g)n=g[m],p&&"map"in n?(a=this._SAT(this.map,
n.map),a.obj=n,a.type="SAT",a&&q.push(a)):q.push({obj:n,type:"MBR"});return q.length?q:!1},onHit:function(a,c,b){var f=!1;this.bind("EnterFrame",function(){var e=this.hit(a);e?(f=!0,c.call(this,e)):f&&("function"==typeof b&&b.call(this),f=!1)});return this},_SAT:function(a,c){for(var b=a.points,f=c.points,e=0,g=b.length,h,n=f.length,k=0,m=0,p,q,r,s,w=null,z=null,B=null,u;e<g;e++){m=b[e==g-1?0:e+1];h=b[e];k=-(m[1]-h[1]);m=m[0]-h[0];h=Math.sqrt(k*k+m*m);k/=h;m/=h;r=s=p=q=-1;for(h=0;h<g;++h){u=b[h][0]*
k+b[h][1]*m;if(u>r||-1===r)r=u;if(u<p||-1===p)p=u}for(h=0;h<n;++h){u=f[h][0]*k+f[h][1]*m;if(u>s||-1===s)s=u;if(u<q||-1===q)q=u}p<q?(h=q-r,k=-k,m=-m):h=p-s;if(0<=h)return!1;if(null===w||h>w)w=h,B={x:k,y:m}}for(e=0;e<n;e++){m=f[e==n-1?0:e+1];h=f[e];k=-(m[1]-h[1]);m=m[0]-h[0];h=Math.sqrt(k*k+m*m);k/=h;m/=h;r=s=p=q=-1;for(h=0;h<g;++h){u=b[h][0]*k+b[h][1]*m;if(u>r||-1===r)r=u;if(u<p||-1===p)p=u}for(h=0;h<n;++h){u=f[h][0]*k+f[h][1]*m;if(u>s||-1===s)s=u;if(u<q||-1===q)q=u}p<q?(h=q-r,k=-k,m=-m):h=p-s;if(0<=
h)return!1;if(null===w||h>w)w=h;if(h>z||null===z)z=h,B={x:k,y:m}}return{overlap:z,normal:B}}});b.c("WiredHitBox",{init:function(){if(b.support.canvas){var a=t.getElementById("HitBox");a||(a=t.createElement("canvas"),a.id="HitBox",a.width=b.viewport.width,a.height=b.viewport.height,a.style.position="absolute",a.style.left="0px",a.style.top="0px",a.style.zIndex="1000",b.stage.elem.appendChild(a));var c=a.getContext("2d"),d=0,f=b("WiredHitBox").length;this.requires("Collision").bind("EnterFrame",function(){d==
f&&(c.clearRect(0,0,b.viewport.width,b.viewport.height),d=0);c.beginPath();for(var a in this.map.points)c.lineTo(b.viewport.x+this.map.points[a][0],b.viewport.y+this.map.points[a][1]);c.closePath();c.stroke();d++})}return this}});b.c("SolidHitBox",{init:function(){if(b.support.canvas){var a=t.getElementById("HitBox");a||(a=t.createElement("canvas"),a.id="HitBox",a.width=b.viewport.width,a.height=b.viewport.height,a.style.position="absolute",a.style.left="0px",a.style.top="0px",a.style.zIndex="1000",
b.stage.elem.appendChild(a));var c=a.getContext("2d"),d=0,f=b("SolidHitBox").length;this.requires("Collision").bind("EnterFrame",function(){d==f&&(c.clearRect(0,0,b.viewport.width,b.viewport.height),d=0);c.beginPath();for(var a in this.map.points)c.lineTo(b.viewport.x+this.map.points[a][0],b.viewport.y+this.map.points[a][1]);c.closePath();c.fill();d++})}return this}});b.c("DOM",{_element:null,_cssStyles:null,init:function(){function a(){var a=0,b=this.__c,f="";for(a in b)f+=" "+a;f=f.substr(1);this._element.className=
f}this._cssStyles={visibility:"",left:"",top:"",width:"",height:"",zIndex:"",opacity:"",transformOrigin:"",transform:""};this._element=t.createElement("div");b.stage.inner.appendChild(this._element);this._element.style.position="absolute";this._element.id="ent"+this[0];this.bind("Change",function(){this._changed||(this._changed=!0,b.DrawManager.add(this))});this.bind("NewComponent",a).bind("RemoveComponent",a);"ms"===b.support.prefix&&9>b.support.version&&(this._filters={},this.bind("Rotate",function(a){var b=
a.matrix;a=b.M11.toFixed(8);var f=b.M12.toFixed(8),e=b.M21.toFixed(8),b=b.M22.toFixed(8);this._filters.rotation="progid:DXImageTransform.Microsoft.Matrix(M11="+a+", M12="+f+", M21="+e+", M22="+b+",sizingMethod='auto expand')"}));this.bind("Remove",this.undraw);this.bind("RemoveComponent",function(a){"DOM"===a&&this.undraw()})},getDomId:function(){return this._element.id},DOM:function(a){a&&a.nodeType&&(this.undraw(),this._element=a,this._element.style.position="absolute");return this},draw:function(){var a=
this._element.style,c=this.__coord||[0,0,0,0],c={x:c[0],y:c[1]},d=b.support.prefix,f=[];this._cssStyles.visibility!=this._visible&&(this._cssStyles.visibility=this._visible,a.visibility=this._visible?"visible":"hidden");b.support.css3dtransform?f.push("translate3d("+~~this._x+"px,"+~~this._y+"px,0)"):(this._cssStyles.left!=this._x&&(this._cssStyles.left=this._x,a.left=~~this._x+"px"),this._cssStyles.top!=this._y&&(this._cssStyles.top=this._y,a.top=~~this._y+"px"));this._cssStyles.width!=this._w&&
(this._cssStyles.width=this._w,a.width=~~this._w+"px");this._cssStyles.height!=this._h&&(this._cssStyles.height=this._h,a.height=~~this._h+"px");this._cssStyles.zIndex!=this._z&&(this._cssStyles.zIndex=this._z,a.zIndex=this._z);this._cssStyles.opacity!=this._alpha&&(this._cssStyles.opacity=this._alpha,a.opacity=this._alpha,a[d+"Opacity"]=this._alpha);"ms"===d&&9>b.support.version&&(this._filters.alpha=8===b.support.version?"progid:DXImageTransform.Microsoft.Alpha(Opacity="+100*this._alpha+")":"alpha(opacity="+
100*this._alpha+")");if(this._mbr){var e=this._origin.x+"px "+this._origin.y+"px";a.transformOrigin=e;a[d+"TransformOrigin"]=e;b.support.css3dtransform?f.push("rotateZ("+this._rotation+"deg)"):f.push("rotate("+this._rotation+"deg)")}this._flipX&&(f.push("scaleX(-1)"),"ms"===d&&9>b.support.version&&(this._filters.flipX="fliph"));this._flipY&&(f.push("scaleY(-1)"),"ms"===d&&9>b.support.version&&(this._filters.flipY="flipv"));"ms"===d&&9>b.support.version&&this.applyFilters();this._cssStyles.transform!=
f.join(" ")&&(this._cssStyles.transform=f.join(" "),a.transform=this._cssStyles.transform,a[d+"Transform"]=this._cssStyles.transform);this.trigger("Draw",{style:a,type:"DOM",co:c});return this},applyFilters:function(){var a=this._element.style.filter="",c;for(c in this._filters)this._filters.hasOwnProperty(c)&&(a+=this._filters[c]+" ");this._element.style.filter=a},undraw:function(){this._element&&b.stage.inner.removeChild(this._element);return this},css:function(a,c){var d,f=this._element,e=f.style;
if("object"===typeof a)for(d in a)a.hasOwnProperty(d)&&(f=a[d],"number"===typeof f&&(f+="px"),e[b.DOM.camelize(d)]=f);else if(c)"number"===typeof c&&(c+="px"),e[b.DOM.camelize(a)]=c;else return b.DOM.getStyle(f,a);this.trigger("Change");return this}});try{t.execCommand("BackgroundImageCache",!1,!0)}catch(s){}b.extend({DOM:{window:{init:function(){this.width=r.innerWidth||r.document.documentElement.clientWidth||r.document.body.clientWidth;this.height=r.innerHeight||r.document.documentElement.clientHeight||
r.document.body.clientHeight},width:0,height:0},inner:function(a){var c=a.getBoundingClientRect(),b=c.left+(r.pageXOffset?r.pageXOffset:t.body.scrollLeft),c=c.top+(r.pageYOffset?r.pageYOffset:t.body.scrollTop),f=parseInt(this.getStyle(a,"border-left-width")||0,10)||parseInt(this.getStyle(a,"borderLeftWidth")||0,10)||0;a=parseInt(this.getStyle(a,"border-top-width")||0,10)||parseInt(this.getStyle(a,"borderTopWidth")||0,10)||0;return{x:b+f,y:c+a}},getStyle:function(a,c){var b;a.currentStyle?b=a.currentStyle[this.camelize(c)]:
r.getComputedStyle&&(b=t.defaultView.getComputedStyle(a,null).getPropertyValue(this.csselize(c)));return b},camelize:function(a){return a.replace(/-+(.)?/g,function(a,b){return b?b.toUpperCase():""})},csselize:function(a){return a.replace(/[A-Z]/g,function(a){return a?"-"+a.toLowerCase():""})},translate:function(a,c){return{x:(a-b.stage.x+t.body.scrollLeft+t.documentElement.scrollLeft-b.viewport._x)/b.viewport._zoom,y:(c-b.stage.y+t.body.scrollTop+t.documentElement.scrollTop-b.viewport._y)/b.viewport._zoom}}}});
b.c("FPS",{values:[],maxValues:60,init:function(){this.bind("MessureFPS",function(a){this.values.length>this.maxValues&&this.values.splice(0,1);this.values.push(a.value)})}});b.c("HTML",{inner:"",init:function(){this.requires("2D, DOM")},replace:function(a){this.inner=a;this._element.innerHTML=a;return this},append:function(a){this.inner+=a;this._element.innerHTML+=a;return this},prepend:function(a){this.inner=a+this.inner;this._element.innerHTML=a+this.inner;return this}});b.storage=function(){function a(c){if(c.c)return b.e(c.c).attr(c.attr).trigger("LoadData",
c,a);if("object"==typeof c)for(var d in c)c[d]=a(c[d]);return c}function c(c){if("string"!=typeof c)return null;c=JSON?JSON.parse(c):eval("("+c+")");return a(c)}function d(a){if(a.__c){var c={c:[],attr:{}};a.trigger("SaveData",c,d);for(var b in a.__c)c.c.push(b);c.c=c.c.join(", ");a=c}else if("object"==typeof a)for(c in a)a[c]=d(a[c]);return a}function f(a){if(JSON)return a=d(a),JSON.stringify(a);alert("Crafty does not support saving on your browser. Please upgrade to a newer browser.");return!1}
function e(a){m=a}function g(){"undefined"!=typeof m&&(xhr.open("POST",m),xhr.onreadystatechange=function(a){if(4==xhr.readyState&&200==xhr.status){a=eval("("+xhr.responseText+")");for(var c in a)b.storage.check(a[c].key,a[c].timestamp)&&n(a[c].key)}},xhr.send("mode=timestamps&game="+p))}function h(a,c,b){if("undefined"!=typeof m){var d=new XMLHttpRequest;d.open("POST",m);d.send("mode=save&key="+a+"&data="+encodeURIComponent(c)+"&ts="+b+"&game="+p)}}function n(a){if("undefined"!=typeof m){var c=new XMLHttpRequest;
c.open("POST",m);c.onreadystatechange=function(d){4==c.readyState&&200==c.status&&(d=eval("("+c.responseText+")"),b.storage.save(a,"save",d))};c.send("mode=load&key="+a+"&game="+p)}}var k=null,m,p,q={},s="readonly",v="readwrite";"object"!=typeof indexedDB&&(r.indexedDB=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB,r.IDBTransaction=r.IDBTransaction||r.webkitIDBTransaction,"object"==typeof IDBTransaction&&(s=IDBTransaction.READ||IDBTransaction.readonly||s,v=IDBTransaction.READ_WRITE||
IDBTransaction.readwrite||v));return"object"==typeof indexedDB?{open:function(a){function c(){try{k.transaction(["save"],s).objectStore("save").getAll().onsuccess=function(a){a=0;for(var c=event.target.result,b=c.length;a<b;a++)q[c[a].key]=c[a].timestamp}}catch(a){}}function b(){k.setVersion("1.0").onsuccess=function(a){for(a=0;a<d.length;a++){var c=d[a];k.objectStoreNames.contains(c)||k.createObjectStore(c,{keyPath:"key"})}}}p=a;var d=[];1!=arguments.length&&(d=arguments,d.shift());d.push("save");
d.push("cache");null==k?indexedDB.open(p).onsuccess=function(a){k=a.target.result;b();c();g()}:(b(),c(),g())},save:function(a,c,d){if(null==k)setTimeout(function(){b.storage.save(a,c,d)},1);else{var e=f(d),g=(new Date).getTime();"save"==c&&h(a,e,g);try{k.transaction([c],v).objectStore(c).put({data:e,timestamp:g,key:a})}catch(m){console.error(m)}}},load:function(a,d,e){if(null==k)setTimeout(function(){b.storage.load(a,d,e)},1);else try{k.transaction([d],s).objectStore(d).get(a).onsuccess=function(a){e(c(a.target.result.data))}}catch(f){console.error(f)}},
getAllKeys:function(a,c){null==k&&setTimeout(function(){b.storage.getAllkeys(a,c)},1);try{var d=[];k.transaction([a],s).objectStore(a).getCursor().onsuccess=function(a){(a=a.target.result)?(d.push(a.key),a["continue"]()):c(d)}}catch(e){console.error(e)}},check:function(a,c){return q[a]>c},external:e}:"function"==typeof openDatabase?{open:function(a){p=a;if(1==arguments.length)k={save:openDatabase(a+"_save","1.0","Saves games for "+a,5242880),cache:openDatabase(a+"_cache","1.0","Cache for "+a,5242880)};
else{var c=arguments,b=0;for(c.shift();b<c.length;b++)"undefined"==typeof k[c[b]]&&(k[c[b]]=openDatabase(p+"_"+c[b],"1.0",type,5242880))}k.save.transaction(function(a){a.executeSql("SELECT key, timestamp FROM data",[],function(a,c){for(var b=0,d=c.rows,e=d.length;b<e;b++)q[d.item(b).key]=d.item(b).timestamp})})},save:function(a,c,b){"undefined"==typeof k[c]&&""!=p&&this.open(p,c);var d=f(b),e=(new Date).getTime();"save"==c&&h(a,d,e);k[c].transaction(function(c){c.executeSql("CREATE TABLE IF NOT EXISTS data (key unique, text, timestamp)");
c.executeSql("SELECT * FROM data WHERE key = ?",[a],function(c,b){b.rows.length?c.executeSql("UPDATE data SET text = ?, timestamp = ? WHERE key = ?",[d,e,a]):c.executeSql("INSERT INTO data VALUES (?, ?, ?)",[a,d,e])})})},load:function(a,d,e){null==k[d]?setTimeout(function(){b.storage.load(a,d,e)},1):k[d].transaction(function(b){b.executeSql("SELECT text FROM data WHERE key = ?",[a],function(a,b){b.rows.length&&(res=c(b.rows.item(0).text),e(res))})})},getAllKeys:function(a,c){null==k[a]?setTimeout(function(){b.storage.getAllKeys(a,
c)},1):k[a].transaction(function(a){a.executeSql("SELECT key FROM data",[],function(a,b){c(b.rows)})})},check:function(a,c){return q[a]>c},external:e}:"object"==typeof r.localStorage?{open:function(a){p=a},save:function(a,c,b){var d=p+"."+c+"."+a;b=f(b);var e=(new Date).getTime();"save"==c&&h(a,b,e);r.localStorage[d]=b;"save"==c&&(r.localStorage[d+".ts"]=e)},load:function(a,b,d){d(c(r.localStorage[p+"."+b+"."+a]))},getAllKeys:function(a,c){var b={},d=[],e=p+"."+a,f;for(f in r.localStorage)if(-1!=
f.indexOf(e)){var g=f.replace(e,"").replace(".ts","");b[g]=!0}for(f in b)d.push(f);c(d)},check:function(a,c){var b=r.localStorage[p+".save."+a+".ts"];return parseInt(c)>parseInt(b)},external:e}:{open:function(a){p=a},save:function(a,c,b){if("save"==c){b=f(b);var d=(new Date).getTime();"save"==c&&h(a,b,d);t.cookie=p+"_"+a+"="+b+"; "+p+"_"+a+"_ts="+d+"; expires=Thur, 31 Dec 2099 23:59:59 UTC; path=/"}},load:function(a,b,d){"save"==b&&(b=(new RegExp(p+"_"+a+"=[^;]*")).exec(t.cookie),a=c(b[0].replace(p+
"_"+a+"=","")),d(a))},getAllKeys:function(a,c){if("save"==a){for(var b=(new RegExp(p+"_[^_=]","g")).exec(t.cookie),d=0,e=b.length,f={},g=[];d<e;d++){var h=b[d].replace(p+"_","");f[h]=!0}for(d in f)g.push(d);c(g)}},check:function(a,c){var b=p+"_"+a+"_ts",b=(new RegExp(b+"=[^;]")).exec(t.cookie)[0].replace(b+"=","");return parseInt(c)>parseInt(b)},external:e}}();(function(){var a=b.support={},c=navigator.userAgent.toLowerCase(),d=/(webkit)[ \/]([\w.]+)/.exec(c)||/(o)pera(?:.*version)?[ \/]([\w.]+)/.exec(c)||
/(ms)ie ([\w.]+)/.exec(c)||/(moz)illa(?:.*? rv:([\w.]+))?/.exec(c)||[];if(c=/iPad|iPod|iPhone|Android|webOS|IEMobile/i.exec(c))b.mobile=c[0];a.setter="__defineSetter__"in this&&"__defineGetter__"in this;a.defineProperty=function(){if(!1 in Object)return!1;try{Object.defineProperty({},"x",{})}catch(a){return!1}return!0}();a.audio="Audio"in r;a.prefix=d[1]||d[0];"moz"===a.prefix&&(a.prefix="Moz");"o"===a.prefix&&(a.prefix="O");d[2]&&(a.versionName=d[2],a.version=+d[2].split(".")[0]);a.canvas="getContext"in
t.createElement("canvas");if(a.canvas){var f;try{f=t.createElement("canvas").getContext("experimental-webgl"),f.viewportWidth=a.canvas.width,f.viewportHeight=a.canvas.height}catch(e){}a.webgl=!!f}else a.webgl=!1;a.css3dtransform="undefined"!==typeof t.createElement("div").style.Perspective||"undefined"!==typeof t.createElement("div").style[a.prefix+"Perspective"];a.deviceorientation="undefined"!==typeof r.DeviceOrientationEvent||"undefined"!==typeof r.OrientationEvent;a.devicemotion="undefined"!==
typeof r.DeviceMotionEvent})();b.extend({zeroFill:function(a,c){c-=a.toString().length;return 0<c?Array(c+(/\./.test(a)?2:1)).join("0")+a:a.toString()},sprite:function(a,c,d,f,e,g){var h,n,k,m,p,q;"string"===typeof a&&(g=e,e=f,f=c,d=a,c=a=1);"string"==typeof c&&(g=e,e=f,f=d,d=c,c=a);!g&&e&&(g=e);e=parseInt(e||0,10);g=parseInt(g||0,10);q=b.asset(d);q||(q=new Image,q.src=d,b.asset(d,q),q.onload=function(){for(h in f)b(h).each(function(){this.ready=!0;this.trigger("Change")})});for(h in f)f.hasOwnProperty(h)&&
(n=f[h],k=n[0]*(a+e),m=n[1]*(c+g),p=n[2]*a||a,n=n[3]*c||c,b.c(h,{ready:!1,__coord:[k,m,p,n],init:function(){this.requires("Sprite");this.__trim=[0,0,0,0];this.__image=d;this.__coord=[this.__coord[0],this.__coord[1],this.__coord[2],this.__coord[3]];this.__tile=a;this.__tileh=c;this.__padding=[e,g];this.img=q;this.img.complete&&0<this.img.width&&(this.ready=!0,this.trigger("Change"));this.w=this.__coord[2];this.h=this.__coord[3]}}));return this},_events:{},addEvent:function(a,c,b,f){3===arguments.length&&
(f=b,b=c,c=r.document);var e=function(c){c=c||r.event;"function"===typeof f&&f.call(a,c)},g=a[0]||"";this._events[g+c+b+f]||(this._events[g+c+b+f]=e,c.attachEvent?c.attachEvent("on"+b,e):c.addEventListener(b,e,!1))},removeEvent:function(a,c,b,f){3===arguments.length&&(f=b,b=c,c=r.document);var e=a[0]||"",g=this._events[e+c+b+f];g&&(c.detachEvent?c.detachEvent("on"+b,g):c.removeEventListener(b,g,!1),delete this._events[e+c+b+f])},background:function(a){b.stage.elem.style.background=a},viewport:{clampToEntities:!0,
width:0,height:0,_x:0,_y:0,bounds:null,scroll:function(a,c){c=Math.floor(c);var d=c-this[a],f=b.canvas.context,e=b.stage.inner.style;this[a]=c;f&&("_x"==a?f.translate(d,0):f.translate(0,d),b.DrawManager.drawAll());e["_x"==a?"left":"top"]=c+"px"},rect:function(){return{_x:-this._x,_y:-this._y,_w:this.width,_h:this.height}},pan:function(){function a(a){a=0;for(d in c){var f=c[d];0<f.remTime?(f.current+=f.diff,f.remTime--,b.viewport[d]=Math.floor(f.current),a++):delete c[d]}a&&b.viewport._clamp()}var c=
{},d,f=!1;return function(e,g,h){b.viewport.follow();if("reset"==e)for(d in c)c[d].remTime=0;else 0==h&&(h=1),c[e]={diff:-g/h,current:b.viewport[e],remTime:h},f||(b.bind("EnterFrame",a),f=!0)}}(),follow:function(){function a(){b.viewport.scroll("_x",-(this.x+this.w/2-b.viewport.width/2-d));b.viewport.scroll("_y",-(this.y+this.h/2-b.viewport.height/2-f));b.viewport._clamp()}var c,d,f;return function(e,g,h){c&&c.unbind("Change",a);e&&e.has("2D")&&(b.viewport.pan("reset"),c=e,d="undefined"!=typeof g?
g:0,f="undefined"!=typeof h?h:0,e.bind("Change",a),a.call(e))}}(),centerOn:function(a,c){var d=a.x+a.w/2-b.viewport.width/2,f=a.y+a.h/2-b.viewport.height/2;b.viewport.pan("reset");b.viewport.pan("x",d,c);b.viewport.pan("y",f,c)},_zoom:1,zoom:function(){function a(){if(0<f){isFinite(b.viewport._zoom)&&(c=b.viewport._zoom);var a=h.width*c,g=h.height*c;c+=d;b.viewport._zoom=c;a=h.width*c-a;g=h.height*c-g;b.stage.inner.style[e]="scale("+c+","+c+")";if(b.canvas._canvas){var p=c/(c-d);b.canvas.context.scale(p,
p);b.DrawManager.drawAll()}b.viewport.x-=a*n.width;b.viewport.y-=g*n.height;f--}}var c=1,d=0,f=0,e=b.support.prefix+"Transform",g=!1,h={},n={};return function(e,m,p,q){var r=this.bounds||b.map.boundaries(),s=e?c*e:1;e||(this._zoom=c=1);h.width=r.max.x-r.min.x;h.height=r.max.y-r.min.y;n.width=m/h.width;n.height=p/h.height;0==q&&(q=1);d=(s-c)/q;f=q;b.viewport.pan("reset");g||(b.bind("EnterFrame",a),g=!0)}}(),scale:function(){var a=b.support.prefix+"Transform";return function(c){this.bounds||b.map.boundaries();
c=c?this._zoom*c:1;var d=c/this._zoom;this._zoom=c;b.viewport.pan("reset");b.stage.inner.style.transform=b.stage.inner.style[a]="scale("+this._zoom+","+this._zoom+")";b.canvas._canvas&&(b.canvas.context.scale(d,d),b.DrawManager.drawAll())}}(),mouselook:function(){var a=!1,c=!1,d={};old={};return function(f,e){if("boolean"==typeof f)(a=f)?b.mouseObjs++:b.mouseObjs=Math.max(0,b.mouseObjs-1);else if(a)switch(f){case "move":case "drag":if(!c)break;diff={x:e.clientX-d.x,y:e.clientY-d.y};b.viewport.x+=
diff.x;b.viewport.y+=diff.y;b.viewport._clamp();case "start":d.x=e.clientX;d.y=e.clientY;c=!0;break;case "stop":c=!1}}}(),_clamp:function(){if(this.clampToEntities){var a=this.bounds||b.map.boundaries();a.max.x*=this._zoom;a.min.x*=this._zoom;a.max.y*=this._zoom;a.min.y*=this._zoom;a.max.x-a.min.x>b.viewport.width?(a.max.x-=b.viewport.width,b.viewport.x<-a.max.x?b.viewport.x=-a.max.x:b.viewport.x>-a.min.x&&(b.viewport.x=-a.min.x)):b.viewport.x=-1*(a.min.x+(a.max.x-a.min.x)/2-b.viewport.width/2);a.max.y-
a.min.y>b.viewport.height?(a.max.y-=b.viewport.height,b.viewport.y<-a.max.y?b.viewport.y=-a.max.y:b.viewport.y>-a.min.y&&(b.viewport.y=-a.min.y)):b.viewport.y=-1*(a.min.y+(a.max.y-a.min.y)/2-b.viewport.height/2)}},init:function(a,c){b.DOM.window.init();this.width=!a||b.mobile?b.DOM.window.width:a;this.height=!c||b.mobile?b.DOM.window.height:c;var d=t.getElementById("cr-stage");b.stage={x:0,y:0,fullscreen:!1,elem:d?d:t.createElement("div"),inner:t.createElement("div")};if(!a&&!c||b.mobile)t.body.style.overflow=
"hidden",b.stage.fullscreen=!0;b.addEvent(this,r,"resize",b.viewport.reload);b.addEvent(this,r,"blur",function(){b.settings.get("autoPause")&&(b._paused||b.pause())});b.addEvent(this,r,"focus",function(){b._paused&&b.settings.get("autoPause")&&b.pause()});b.settings.register("stageSelectable",function(a){b.stage.elem.onselectstart=a?function(){return!0}:function(){return!1}});b.settings.modify("stageSelectable",!1);b.settings.register("stageContextMenu",function(a){b.stage.elem.oncontextmenu=a?function(){return!0}:
function(){return!1}});b.settings.modify("stageContextMenu",!1);b.settings.register("autoPause",function(){});b.settings.modify("autoPause",!1);d||(t.body.appendChild(b.stage.elem),b.stage.elem.id="cr-stage");d=b.stage.elem.style;b.stage.elem.appendChild(b.stage.inner);b.stage.inner.style.position="absolute";b.stage.inner.style.zIndex="1";d.width=this.width+"px";d.height=this.height+"px";d.overflow="hidden";if(b.mobile){d.position="absolute";d.left="0px";d.top="0px";void 0!=typeof d.webkitTapHighlightColor&&
(d.webkitTapHighlightColor="rgba(0,0,0,0)");var d=t.createElement("meta"),f=t.getElementsByTagName("HEAD")[0];d.setAttribute("name","viewport");d.setAttribute("content","width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no");f.appendChild(d);d=t.createElement("meta");d.setAttribute("name","apple-mobile-web-app-capable");d.setAttribute("content","yes");f.appendChild(d);setTimeout(function(){r.scrollTo(0,1)},0);b.addEvent(this,r,"touchmove",function(a){a.preventDefault()});b.stage.x=
0;b.stage.y=0}else d.position="relative",d=b.DOM.inner(b.stage.elem),b.stage.x=d.x,b.stage.y=d.y;b.support.setter?(this.__defineSetter__("x",function(a){this.scroll("_x",a)}),this.__defineSetter__("y",function(a){this.scroll("_y",a)}),this.__defineGetter__("x",function(){return this._x}),this.__defineGetter__("y",function(){return this._y})):b.support.defineProperty?(Object.defineProperty(this,"x",{set:function(a){this.scroll("_x",a)},get:function(){return this._x}}),Object.defineProperty(this,"y",
{set:function(a){this.scroll("_y",a)},get:function(){return this._y}})):(this.x=this._x,this.y=this._y,b.e("viewport"))},reload:function(){b.DOM.window.init();var a=b.DOM.window.width,c=b.DOM.window.height;b.stage.fullscreen&&(this.width=a,this.height=c,b.stage.elem.style.width=a+"px",b.stage.elem.style.height=c+"px",b.canvas._canvas&&(b.canvas._canvas.width=a,b.canvas._canvas.height=c,b.DrawManager.drawAll()));a=b.DOM.inner(b.stage.elem);b.stage.x=a.x;b.stage.y=a.y},reset:function(){b.viewport.pan("reset");
b.viewport.follow();b.viewport.mouselook("stop");b.viewport.scale()}},keys:{BACKSPACE:8,TAB:9,ENTER:13,PAUSE:19,CAPS:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,
NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBSTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,SHIFT:16,CTRL:17,ALT:18,PLUS:187,COMMA:188,MINUS:189,PERIOD:190,PULT_UP:29460,PULT_DOWN:29461,PULT_LEFT:4,PULT_RIGHT:5},mouseButtons:{LEFT:0,MIDDLE:1,RIGHT:2}});b.c("viewport",{init:function(){this.bind("EnterFrame",function(){b.viewport._x!==b.viewport.x&&b.viewport.scroll("_x",b.viewport.x);b.viewport._y!==
b.viewport.y&&b.viewport.scroll("_y",b.viewport.y)})}});b.extend({device:{_deviceOrientationCallback:!1,_deviceMotionCallback:!1,_normalizeDeviceOrientation:function(a){var c;r.DeviceOrientationEvent?c={tiltLR:a.gamma,tiltFB:a.beta,dir:a.alpha,motUD:null}:r.OrientationEvent&&(c={tiltLR:90*a.x,tiltFB:-90*a.y,dir:null,motUD:a.z});b.device._deviceOrientationCallback(c)},_normalizeDeviceMotion:function(a){a=a.accelerationIncludingGravity;var c=0<a.z?1:-1;a={acceleration:a,rawAcceleration:"["+Math.round(a.x)+
", "+Math.round(a.y)+", "+Math.round(a.z)+"]",facingUp:c,tiltLR:Math.round(a.x/9.81*-90),tiltFB:Math.round((a.y+9.81)/9.81*90*c)};b.device._deviceMotionCallback(a)},deviceOrientation:function(a){this._deviceOrientationCallback=a;b.support.deviceorientation&&(r.DeviceOrientationEvent?b.addEvent(this,r,"deviceorientation",this._normalizeDeviceOrientation):r.OrientationEvent&&b.addEvent(this,r,"MozOrientation",this._normalizeDeviceOrientation))},deviceMotion:function(a){this._deviceMotionCallback=a;
b.support.devicemotion&&r.DeviceMotionEvent&&b.addEvent(this,r,"devicemotion",this._normalizeDeviceMotion)}}});b.c("Sprite",{__image:"",__tile:0,__tileh:0,__padding:null,__trim:null,img:null,ready:!1,init:function(){this.__trim=[0,0,0,0];var a=function(a){var b=a.co,f=a.pos,e=a.ctx;"canvas"===a.type?e.drawImage(this.img,b.x,b.y,b.w,b.h,f._x,f._y,f._w,f._h):"DOM"===a.type&&(this._element.style.background="url('"+this.__image+"') no-repeat -"+b.x+"px -"+b.y+"px")};this.bind("Draw",a).bind("RemoveComponent",
function(c){"Sprite"===c&&this.unbind("Draw",a)})},sprite:function(a,c,b,f){this.__coord=[a*this.__tile+this.__padding[0]+this.__trim[0],c*this.__tileh+this.__padding[1]+this.__trim[1],this.__trim[2]||b*this.__tile||this.__tile,this.__trim[3]||f*this.__tileh||this.__tileh];this.trigger("Change");return this},crop:function(a,c,b,f){var e=this._mbr||this.pos();this.__trim=[];this.__trim[0]=a;this.__trim[1]=c;this.__trim[2]=b;this.__trim[3]=f;this.__coord[0]+=a;this.__coord[1]+=c;this.__coord[2]=b;this.__coord[3]=
f;this._w=b;this._h=f;this.trigger("Change",e);return this}});b.c("Canvas",{init:function(){b.canvas.context||b.canvas.init();b.DrawManager.total2D++;this.bind("Change",function(a){!1===this._changed?this._changed=b.DrawManager.add(a||this,this):a&&(this._changed=b.DrawManager.add(a,this))});this.bind("Remove",function(){b.DrawManager.total2D--;b.DrawManager.add(this,this)})},draw:function(a,c,d,f,e){if(this.ready){4===arguments.length&&(e=f,f=d,d=c,c=a,a=b.canvas.context);var g={_x:this._x+(c||0),
_y:this._y+(d||0),_w:f||this._w,_h:e||this._h},h=a||b.canvas.context,n=this.__coord||[0,0,0,0],n={x:n[0]+(c||0),y:n[1]+(d||0),w:f||n[2],h:e||n[3]};this._mbr&&(h.save(),h.translate(this._origin.x+this._x,this._origin.y+this._y),g._x=-this._origin.x,g._y=-this._origin.y,h.rotate(this._rotation%360*(Math.PI/180)));if(this._flipX||this._flipY)h.save(),h.scale(this._flipX?-1:1,this._flipY?-1:1),this._flipX&&(g._x=-(g._x+g._w)),this._flipY&&(g._y=-(g._y+g._h));if(1>this._alpha){var k=h.globalAlpha;h.globalAlpha=
this._alpha}this.trigger("Draw",{type:"canvas",pos:g,co:n,ctx:h});(this._mbr||this._flipX||this._flipY)&&h.restore();k&&(h.globalAlpha=k);return this}}});b.extend({canvas:{context:null,init:function(){if(b.support.canvas){var a;a=t.createElement("canvas");a.width=b.viewport.width;a.height=b.viewport.height;a.style.position="absolute";a.style.left="0px";a.style.top="0px";b.stage.elem.appendChild(a);b.canvas.context=a.getContext("2d");b.canvas._canvas=a}else b.trigger("NoCanvas"),b.stop()}}});b.extend({over:null,
mouseObjs:0,mousePos:{},lastEvent:null,keydown:{},selected:!1,detectBlur:function(a){a=a.clientX>b.stage.x&&a.clientX<b.stage.x+b.viewport.width&&a.clientY>b.stage.y&&a.clientY<b.stage.y+b.viewport.height;!b.selected&&a&&b.trigger("CraftyFocus");b.selected&&!a&&b.trigger("CraftyBlur");b.selected=a},mouseDispatch:function(a){if(b.mouseObjs){b.lastEvent=a;var c=-1,d,f,e=0,g,h=b.DOM.translate(a.clientX,a.clientY),n,k={};f=a.target?a.target:a.srcElement;var m=a.type;a.mouseButton=null==a.which?2>a.button?
b.mouseButtons.LEFT:4==a.button?b.mouseButtons.MIDDLE:b.mouseButtons.RIGHT:2>a.which?b.mouseButtons.LEFT:2==a.which?b.mouseButtons.MIDDLE:b.mouseButtons.RIGHT;a.realX=n=b.mousePos.x=h.x;a.realY=h=b.mousePos.y=h.y;if("CANVAS"!=f.nodeName){for(;"string"!=typeof f.id&&-1==f.id.indexOf("ent");)f=f.parentNode;ent=b(parseInt(f.id.replace("ent","")));ent.has("Mouse")&&ent.isAt(n,h)&&(d=ent)}if(!d)for(f=b.map.search({_x:n,_y:h,_w:1,_h:1},!1),g=f.length;e<g;++e)if(f[e].__c.Mouse&&f[e]._visible){var p=f[e],
q=!1;k[p[0]]||(k[p[0]]=!0,p.mapArea?p.mapArea.containsPoint(n,h)&&(q=!0):p.isAt(n,h)&&(q=!0),!q||!(p._z>=c||-1===c)||p._z===c&&p[0]<d[0]||(c=p._z,d=p))}d?"mousedown"===m?d.trigger("MouseDown",a):"mouseup"===m?d.trigger("MouseUp",a):"dblclick"==m?d.trigger("DoubleClick",a):"click"==m?d.trigger("Click",a):"mousemove"===m?(d.trigger("MouseMove",a),this.over!==d&&(this.over&&(this.over.trigger("MouseOut",a),this.over=null),this.over=d,d.trigger("MouseOver",a))):d.trigger(m,a):("mousemove"===m&&this.over&&
(this.over.trigger("MouseOut",a),this.over=null),"mousedown"===m?b.viewport.mouselook("start",a):"mousemove"===m?b.viewport.mouselook("drag",a):"mouseup"==m&&b.viewport.mouselook("stop"));"mousemove"===m&&(this.lastEvent=a)}},touchDispatch:function(a){var c,d=b.lastEvent;"touchstart"===a.type?c="mousedown":"touchmove"===a.type?c="mousemove":"touchend"===a.type?c="mouseup":"touchcancel"===a.type?c="mouseup":"touchleave"===a.type&&(c="mouseup");a.touches&&a.touches.length?first=a.touches[0]:a.changedTouches&&
a.changedTouches.length&&(first=a.changedTouches[0]);var f=t.createEvent("MouseEvent");f.initMouseEvent(c,!0,!0,r,1,first.screenX,first.screenY,first.clientX,first.clientY,!1,!1,!1,!1,0,a.relatedTarget);first.target.dispatchEvent(f);null!=d&&"mousedown"==d.type&&"mouseup"==c&&(c="click",f=t.createEvent("MouseEvent"),f.initMouseEvent(c,!0,!0,r,1,first.screenX,first.screenY,first.clientX,first.clientY,!1,!1,!1,!1,0,a.relatedTarget),first.target.dispatchEvent(f));a.preventDefault?a.preventDefault():
a.returnValue=!1},keyboardDispatch:function(a){a.key=a.keyCode||a.which;"keydown"===a.type?!0!==b.keydown[a.key]&&(b.keydown[a.key]=!0,b.trigger("KeyDown",a)):"keyup"===a.type&&(delete b.keydown[a.key],b.trigger("KeyUp",a));if(b.selected&&!(8==a.key||112<=a.key&&135>=a.key))return a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,a.preventDefault?a.preventDefault():a.returnValue=!1,!1}});b.bind("Load",function(){b.addEvent(this,"keydown",b.keyboardDispatch);b.addEvent(this,"keyup",b.keyboardDispatch);
b.addEvent(this,b.stage.elem,"mousedown",b.mouseDispatch);b.addEvent(this,b.stage.elem,"mouseup",b.mouseDispatch);b.addEvent(this,t.body,"mouseup",b.detectBlur);b.addEvent(this,b.stage.elem,"mousemove",b.mouseDispatch);b.addEvent(this,b.stage.elem,"click",b.mouseDispatch);b.addEvent(this,b.stage.elem,"dblclick",b.mouseDispatch);b.addEvent(this,b.stage.elem,"touchstart",b.touchDispatch);b.addEvent(this,b.stage.elem,"touchmove",b.touchDispatch);b.addEvent(this,b.stage.elem,"touchend",b.touchDispatch);
b.addEvent(this,b.stage.elem,"touchcancel",b.touchDispatch);b.addEvent(this,b.stage.elem,"touchleave",b.touchDispatch)});b.bind("CraftyStop",function(){b.removeEvent(this,"keydown",b.keyboardDispatch);b.removeEvent(this,"keyup",b.keyboardDispatch);b.stage&&(b.removeEvent(this,b.stage.elem,"mousedown",b.mouseDispatch),b.removeEvent(this,b.stage.elem,"mouseup",b.mouseDispatch),b.removeEvent(this,b.stage.elem,"mousemove",b.mouseDispatch),b.removeEvent(this,b.stage.elem,"click",b.mouseDispatch),b.removeEvent(this,
b.stage.elem,"dblclick",b.mouseDispatch),b.removeEvent(this,b.stage.elem,"touchstart",b.touchDispatch),b.removeEvent(this,b.stage.elem,"touchmove",b.touchDispatch),b.removeEvent(this,b.stage.elem,"touchend",b.touchDispatch),b.removeEvent(this,b.stage.elem,"touchcancel",b.touchDispatch),b.removeEvent(this,b.stage.elem,"touchleave",b.touchDispatch));b.removeEvent(this,t.body,"mouseup",b.detectBlur)});b.c("Mouse",{init:function(){b.mouseObjs++;this.bind("Remove",function(){b.mouseObjs--})},areaMap:function(a){if(1<
arguments.length){var c=Array.prototype.slice.call(arguments,0);a=new b.polygon(c)}a.shift(this._x,this._y);this.mapArea=a;this.attach(this.mapArea);return this}});b.c("Draggable",{_origMouseDOMPos:null,_oldX:null,_oldY:null,_dragging:!1,_dir:null,_ondrag:null,_ondown:null,_onup:null,init:function(){this.requires("Mouse");this._ondrag=function(a){var c=b.DOM.translate(a.clientX,a.clientY);if(0==c.x||0==c.y)return!1;this._dir?(c=(c.x-this._origMouseDOMPos.x)*this._dir.x+(c.y-this._origMouseDOMPos.y)*
this._dir.y,this.x=this._oldX+c*this._dir.x,this.y=this._oldY+c*this._dir.y):(this.x=this._oldX+(c.x-this._origMouseDOMPos.x),this.y=this._oldY+(c.y-this._origMouseDOMPos.y));this.trigger("Dragging",a)};this._ondown=function(a){a.mouseButton===b.mouseButtons.LEFT&&this._startDrag(a)};this._onup=function(a){1==this._dragging&&(b.removeEvent(this,b.stage.elem,"mousemove",this._ondrag),b.removeEvent(this,b.stage.elem,"mouseup",this._onup),this._dragging=!1,this.trigger("StopDrag",a))};this.enableDrag()},
dragDirection:function(a){if("undefined"===typeof a)this._dir=null;else if(""+parseInt(a)==a)this._dir={x:Math.cos(a/180*Math.PI),y:Math.sin(a/180*Math.PI)};else{var c=Math.sqrt(a.x*a.x+a.y*a.y);this._dir={x:a.x/c,y:a.y/c}}},_startDrag:function(a){this._origMouseDOMPos=b.DOM.translate(a.clientX,a.clientY);this._oldX=this._x;this._oldY=this._y;this._dragging=!0;b.addEvent(this,b.stage.elem,"mousemove",this._ondrag);b.addEvent(this,b.stage.elem,"mouseup",this._onup);this.trigger("StartDrag",a)},stopDrag:function(){b.removeEvent(this,
b.stage.elem,"mousemove",this._ondrag);b.removeEvent(this,b.stage.elem,"mouseup",this._onup);this._dragging=!1;this.trigger("StopDrag");return this},startDrag:function(){this._dragging||this._startDrag(b.lastEvent);return this},enableDrag:function(){this.bind("MouseDown",this._ondown);b.addEvent(this,b.stage.elem,"mouseup",this._onup);return this},disableDrag:function(){this.unbind("MouseDown",this._ondown);this.stopDrag();return this}});b.c("Keyboard",{isDown:function(a){"string"===typeof a&&(a=
b.keys[a]);return!!b.keydown[a]}});b.c("Multiway",{_speed:3,_keydown:function(a){this._keys[a.key]&&(this._movement.x=Math.round(1E3*(this._movement.x+this._keys[a.key].x))/1E3,this._movement.y=Math.round(1E3*(this._movement.y+this._keys[a.key].y))/1E3,this.trigger("NewDirection",this._movement))},_keyup:function(a){this._keys[a.key]&&(this._movement.x=Math.round(1E3*(this._movement.x-this._keys[a.key].x))/1E3,this._movement.y=Math.round(1E3*(this._movement.y-this._keys[a.key].y))/1E3,this.trigger("NewDirection",
this._movement))},_enterframe:function(){this.disableControls||(0!==this._movement.x&&(this.x+=this._movement.x,this.trigger("Moved",{x:this.x-this._movement.x,y:this.y})),0!==this._movement.y&&(this.y+=this._movement.y,this.trigger("Moved",{x:this.x,y:this.y-this._movement.y})))},multiway:function(a,c){this._keyDirection={};this._keys={};this._movement={x:0,y:0};this._speed={x:3,y:3};c?a.x&&a.y?(this._speed.x=a.x,this._speed.y=a.y):(this._speed.x=a,this._speed.y=a):c=a;this._keyDirection=c;this.speed(this._speed);
this.disableControl();this.enableControl();for(var d in c)b.keydown[b.keys[d]]&&this.trigger("KeyDown",{key:b.keys[d]});return this},enableControl:function(){this.bind("KeyDown",this._keydown).bind("KeyUp",this._keyup).bind("EnterFrame",this._enterframe);return this},disableControl:function(){this.unbind("KeyDown",this._keydown).unbind("KeyUp",this._keyup).unbind("EnterFrame",this._enterframe);return this},speed:function(a){for(var c in this._keyDirection)this._keys[b.keys[c]||c]={x:Math.round(1E3*
Math.cos(Math.PI/180*this._keyDirection[c])*a.x)/1E3,y:Math.round(1E3*Math.sin(Math.PI/180*this._keyDirection[c])*a.y)/1E3};return this}});b.c("Fourway",{init:function(){this.requires("Multiway")},fourway:function(a){this.multiway(a,{UP_ARROW:-90,DOWN_ARROW:90,RIGHT_ARROW:0,LEFT_ARROW:180,W:-90,S:90,D:0,A:180,Z:-90,Q:180});return this}});b.c("Twoway",{_speed:3,_up:!1,init:function(){this.requires("Fourway, Keyboard")},twoway:function(a,c){this.multiway(a,{RIGHT_ARROW:0,LEFT_ARROW:180,D:0,A:180,Q:180});
a&&(this._speed=a);c=c||2*this._speed;this.bind("EnterFrame",function(){!this.disableControls&&this._up&&(this.y-=c,this._falling=!0)}).bind("KeyDown",function(){if(this.isDown("UP_ARROW")||this.isDown("W")||this.isDown("Z"))this._up=!0});return this}});b.c("Animation",{_reel:null,init:function(){this._reel={}},addAnimation:function(a,c){var b,f=0,e=0,g,h,n={},k,m,p=[];for(b in c){e=c[b];g=c[f]||this;n={};for(h in e)n[h]="number"!==typeof e[h]?e[h]:(e[h]-g[h])/(b-f);e=+f+1;for(f=1;e<=+b;++e,++f){m=
{};for(k in n)m[k]="number"===typeof n[k]?g[k]+n[k]*f:n[k];p[e]=m}f=b}this._reel[a]=p;return this},playAnimation:function(a){var c=this._reel[a],b=0,f=c.length,e;this.bind("EnterFrame",function h(){for(e in c[b])this[e]=c[b][e];b++;b>f&&(this.trigger("AnimationEnd"),this.unbind("EnterFrame",h))})}});b.c("SpriteAnimation",{_reels:null,_frame:null,_currentReelId:null,init:function(){this._reels={}},animate:function(a,c,b,f){var e,g,h,n,k;if(4>arguments.length&&"number"===typeof c)return this._currentReelId=
a,currentReel=this._reels[a],this._frame={currentReel:currentReel,numberOfFramesBetweenSlides:Math.ceil(c/currentReel.length),currentSlideNumber:0,frameNumberBetweenSlides:0,repeat:0},3===arguments.length&&"number"===typeof b&&(-1===b?this._frame.repeatInfinitly=!0:this._frame.repeat=b),k=this._frame.currentReel[0],this.__coord[0]=k[0],this.__coord[1]=k[1],this.bind("EnterFrame",this.updateSprite),this;if("number"===typeof c){h=this.__tile+parseInt(this.__padding[0]||0,10);n=this.__tileh+parseInt(this.__padding[1]||
0,10);e=[];g=c;if(f>c)for(;g<=f;g++)e.push([g*h,b*n]);else for(;g>=f;g--)e.push([g*h,b*n]);this._reels[a]=e}else if("object"===typeof c){g=0;e=[];f=c.length-1;h=this.__tile+parseInt(this.__padding[0]||0,10);for(n=this.__tileh+parseInt(this.__padding[1]||0,10);g<=f;g++)k=c[g],e.push([k[0]*h,k[1]*n]);this._reels[a]=e}return this},updateSprite:function(){var a=this._frame;if(a){if(this._frame.frameNumberBetweenSlides++===a.numberOfFramesBetweenSlides){var c=a.currentReel[a.currentSlideNumber++];this.__coord[0]=
c[0];this.__coord[1]=c[1];this._frame.frameNumberBetweenSlides=0}if(a.currentSlideNumber===a.currentReel.length)if(!0===this._frame.repeatInfinitly||0<this._frame.repeat)this._frame.repeat&&this._frame.repeat--,this._frame.frameNumberBetweenSlides=0,this._frame.currentSlideNumber=0;else if(this._frame.frameNumberBetweenSlides===a.numberOfFramesBetweenSlides){this.trigger("AnimationEnd",{reel:a.currentReel});this.stop();return}this.trigger("Change")}},stop:function(){this.unbind("EnterFrame",this.updateSprite);
this.unbind("AnimationEnd");this._frame=this._currentReelId=null;return this},reset:function(){if(!this._frame)return this;var a=this._frame.currentReel[0];this.__coord[0]=a[0];this.__coord[1]=a[1];this.stop();return this},isPlaying:function(a){return a?this._currentReelId===a:!!this._currentReelId}});b.c("Tween",{_step:null,_numProps:0,tween:function(a,c){this.each(function(){null==this._step&&(this._step={},this.bind("EnterFrame",y),this.bind("RemoveComponent",function(a){"Tween"==a&&this.unbind("EnterFrame",
y)}));for(var b in a)this._step[b]={prop:a[b],val:(a[b]-this[b])/c,rem:c},this._numProps++});return this}});b.c("Color",{_color:"",ready:!0,init:function(){this.bind("Draw",function(a){"DOM"===a.type?(a.style.background=this._color,a.style.lineHeight=0):"canvas"===a.type&&(this._color&&(a.ctx.fillStyle=this._color),a.ctx.fillRect(a.pos._x,a.pos._y,a.pos._w,a.pos._h))})},color:function(a){if(!a)return this._color;this._color=a;this.trigger("Change");return this}});b.c("Tint",{_color:null,_strength:1,
init:function(){var a=function(a){var d=a.ctx||b.canvas.context;d.fillStyle=this._color||"rgb(0,0,0)";d.fillRect(a.pos._x,a.pos._y,a.pos._w,a.pos._h)};this.bind("Draw",a).bind("RemoveComponent",function(c){"Tint"===c&&this.unbind("Draw",a)})},tint:function(a,c){this._strength=c;this._color=b.toRGB(a,this._strength);this.trigger("Change");return this}});b.c("Image",{_repeat:"repeat",ready:!1,init:function(){var a=function(a){if("canvas"===a.type){if(this.ready&&this._pattern){var b=a.ctx;b.fillStyle=
this._pattern;b.save();b.translate(a.pos._x,a.pos._y);b.fillRect(0,0,this._w,this._h);b.restore()}}else"DOM"===a.type&&this.__image&&(a.style.background="url("+this.__image+") "+this._repeat)};this.bind("Draw",a).bind("RemoveComponent",function(c){"Image"===c&&this.unbind("Draw",a)})},image:function(a,c){this.__image=a;this._repeat=c||"no-repeat";if(this.img=b.asset(a))this.ready=!0,this.has("Canvas")&&(this._pattern=b.canvas.context.createPattern(this.img,this._repeat)),"no-repeat"===this._repeat&&
(this.w=this.img.width,this.h=this.img.height);else{this.img=new Image;b.asset(a,this.img);this.img.src=a;var d=this;this.img.onload=function(){d.has("Canvas")&&(d._pattern=b.canvas.context.createPattern(d.img,d._repeat));d.ready=!0;"no-repeat"===d._repeat&&(d.w=d.img.width,d.h=d.img.height);d.trigger("Change")};return this}this.trigger("Change");return this}});b.extend({_scenes:[],_current:null,scene:function(a,c,d){if(1===arguments.length){b.viewport.reset();b("2D").each(function(){this.has("Persist")||
this.destroy()});null!==this._current&&"uninitialize"in this._scenes[this._current]&&this._scenes[this._current].uninitialize.call(this);this._scenes[a].initialize.call(this);var f=this._current;this._current=a;b.trigger("SceneChange",{oldScene:f,newScene:a})}else this._scenes[a]={},this._scenes[a].initialize=c,"undefined"!==typeof d&&(this._scenes[a].uninitialize=d)},toRGB:function(a,c){a="#"===a.charAt(0)?a.substr(1):a;var b=[];b[0]=parseInt(a.substr(0,2),16);b[1]=parseInt(a.substr(2,2),16);b[2]=
parseInt(a.substr(4,2),16);return void 0===c?"rgb("+b.join(",")+")":"rgba("+b.join(",")+","+c+")"}});b.DrawManager=function(){var a=[],c=[];return{total2D:b("2D").length,onScreen:function(a){return 0<b.viewport._x+a._x+a._w&&0<b.viewport._y+a._y+a._h&&b.viewport._x+a._x<b.viewport.width&&b.viewport._y+a._y<b.viewport.height},merge:function(a){do{for(var c=[],e=!1,g=0,h=a.length,n,k;g<h;)n=a[g],k=a[g+1],g<h-1&&n._x<k._x+k._w&&n._x+n._w>k._x&&n._y<k._y+k._h&&n._h+n._y>k._y?(e={_x:~~Math.min(n._x,k._x),
_y:~~Math.min(n._y,k._y),_w:Math.max(n._x,k._x)+Math.max(n._w,k._w),_h:Math.max(n._y,k._y)+Math.max(n._h,k._h)},e._w-=e._x,e._h-=e._y,e._w=e._w==~~e._w?e._w:e._w+1|0,e._h=e._h==~~e._h?e._h:e._h+1|0,c.push(e),g++,e=!0):c.push(n),g++;a=c.length?b.clone(c):a}while(e);return a},add:function(b,f){if(f){var e;e=b._mbr||b;var g=f._mbr||f;b===f?e=b.mbr()||b.pos():(e={_x:~~Math.min(e._x,g._x),_y:~~Math.min(e._y,g._y),_w:Math.max(e._w,g._w)+Math.max(e._x,g._x),_h:Math.max(e._h,g._h)+Math.max(e._y,g._y)},e._w-=
e._x,e._h-=e._y);if(0===e._w||0===e._h||!this.onScreen(e))return!1;e._x=~~e._x;e._y=~~e._y;e._w=e._w===~~e._w?e._w:e._w+1|0;e._h=e._h===~~e._h?e._h:e._h+1|0;a.push(e);return!0}c.push(b)},debug:function(){console.log(a,c)},drawAll:function(a){a=a||b.viewport.rect();var c=b.map.search(a),e=0,g=c.length;b.canvas.context.clearRect(a._x,a._y,a._w,a._h);for(c.sort(function(a,b){return a._globalZ-b._globalZ});e<g;e++)a=c[e],a._visible&&a.__c.Canvas&&(a.draw(),a._changed=!1)},boundingRect:function(a){if(a&&
a.length){for(var b=1,c=a.length,g,h=a[0],h=[h._x,h._y,h._x+h._w,h._y+h._h];b<c;)g=a[b],g=[g._x,g._y,g._x+g._w,g._y+g._h],g[0]<h[0]&&(h[0]=g[0]),g[1]<h[1]&&(h[1]=g[1]),g[2]>h[2]&&(h[2]=g[2]),g[3]>h[3]&&(h[3]=g[3]),b++;g=h;return h={_x:g[0],_y:g[1],_w:g[2]-g[0],_h:g[3]-g[1]}}},draw:function(){if(a.length||c.length){for(var d=0,f=a.length,e=c.length,g,h,n,k,m,p=[],q=b.canvas.context;d<e;++d)c[d].draw()._changed=!1;c.length=0;if(f)if(.6<f/this.total2D)this.drawAll(),a.length=0;else{a=this.merge(a);for(d=
0;d<f;++d)if(e=a[d]){g=b.map.search(e,!1);k={};h=0;for(n=g.length;h<n;++h)m=g[h],!k[m[0]]&&m._visible&&m.__c.Canvas&&(k[m[0]]=!0,p.push({obj:m,rect:e}));q.clearRect(e._x,e._y,e._w,e._h)}p.sort(function(a,b){return a.obj._globalZ-b.obj._globalZ});if(p.length){d=0;for(f=p.length;d<f;++d)m=p[d],e=m.rect,g=m.obj,h=g._mbr||g,n=0>e._y-h._y?0:~~(e._y-h._y),k=~~Math.min(h._w-(0>=e._x-h._x?0:~~(e._x-h._x)),e._w-(h._x-e._x),e._w,h._w),0!==~~Math.min(h._h-n,e._h-(h._y-e._y),e._h,h._h)&&0!==k&&(q.save(),q.beginPath(),
q.moveTo(e._x,e._y),q.lineTo(e._x+e._w,e._y),q.lineTo(e._x+e._w,e._h+e._y),q.lineTo(e._x,e._h+e._y),q.lineTo(e._x,e._y),q.clip(),g.draw(),q.closePath(),q.restore(),g._changed=!1);a.length=0;merged={}}}}}}}();b.extend({isometric:{_tile:{width:0,height:0},_elements:{},_pos:{x:0,y:0},_z:0,size:function(a,b){this._tile.width=a;this._tile.height=0<b?b:a/2;return this},place:function(a,c,d,f){a=this.pos2px(a,c);a.top-=this._tile.width/2*d;f.attr({x:a.left+b.viewport._x,y:a.top+b.viewport._y}).z+=d;return this},
pos2px:function(a,b){return{left:a*this._tile.width+this._tile.width/2*(b&1),top:b*this._tile.height/2}},px2pos:function(a,b){return{x:Math.ceil(-a/this._tile.width-.5*(b&1)),y:-b/this._tile.height*2}},centerAt:function(a,c){if("number"==typeof a&&"number"==typeof c){var d=this.pos2px(a,c);b.viewport._x=-d.left+b.viewport.width/2-this._tile.width/2;b.viewport._y=-d.top+b.viewport.height/2-this._tile.height/2;return this}return{top:-b.viewport._y+b.viewport.height/2-this._tile.height/2,left:-b.viewport._x+
b.viewport.width/2-this._tile.width/2}},area:function(){var a=this.centerAt(),c=this.px2pos(-a.left+b.viewport.width/2,-a.top+b.viewport.height/2),a=this.px2pos(-a.left-b.viewport.width/2,-a.top-b.viewport.height/2);return{x:{start:c.x,end:a.x},y:{start:c.y,end:a.y}}}}});b.c("Particles",{init:function(){this._Particles=b.clone(this._Particles)},particles:function(a){if(!b.support.canvas||b.deactivateParticles)return this;var c,d,f,e,g;c=t.createElement("canvas");c.width=b.viewport.width;c.height=
b.viewport.height;c.style.position="absolute";b.stage.elem.appendChild(c);d=c.getContext("2d");this._Particles.init(a);this.bind("Remove",function(){b.stage.elem.removeChild(c)}).bind("RemoveComponent",function(a){"particles"===a&&b.stage.elem.removeChild(c)});f=this.x+b.viewport.x;e=this.y+b.viewport.y;this._Particles.position=this._Particles.vectorHelpers.create(f,e);var h=b.viewport.x,n=b.viewport.y;this.bind("EnterFrame",function(){f=this.x+b.viewport.x;e=this.y+b.viewport.y;this._Particles.viewportDelta=
{x:b.viewport.x-h,y:b.viewport.y-n};h=b.viewport.x;n=b.viewport.y;this._Particles.position=this._Particles.vectorHelpers.create(f,e);"function"==typeof b.DrawManager.boundingRect?(g=b.DrawManager.boundingRect(this._Particles.register))&&d.clearRect(g._x,g._y,g._w,g._h):d.clearRect(0,0,b.viewport.width,b.viewport.height);this._Particles.update();this._Particles.render(d)});return this},_Particles:{presets:{maxParticles:150,size:18,sizeRandom:4,speed:1,speedRandom:1.2,lifeSpan:29,lifeSpanRandom:7,angle:65,
angleRandom:34,startColour:[255,131,0,1],startColourRandom:[48,50,45,0],endColour:[245,35,0,0],endColourRandom:[60,60,60,0],sharpness:20,sharpnessRandom:10,spread:10,duration:-1,fastMode:!1,gravity:{x:0,y:.1},jitter:0,particles:[],active:!0,particleCount:0,elapsedFrames:0,emissionRate:0,emitCounter:0,particleIndex:0},init:function(a){this.position=this.vectorHelpers.create(0,0);"undefined"==typeof a&&(a={});for(key in this.presets)this[key]="undefined"!=typeof a[key]?a[key]:this.presets[key];this.emissionRate=
this.maxParticles/this.lifeSpan;this.positionRandom=this.vectorHelpers.create(this.spread,this.spread)},addParticle:function(){if(this.particleCount==this.maxParticles)return!1;var a=new this.particle(this.vectorHelpers);this.initParticle(a);this.particles[this.particleCount]=a;this.particleCount++;return!0},RANDM1TO1:function(){return 2*Math.random()-1},initParticle:function(a){a.position.x=this.position.x+this.positionRandom.x*this.RANDM1TO1();a.position.y=this.position.y+this.positionRandom.y*
this.RANDM1TO1();var b=(this.angle+this.angleRandom*this.RANDM1TO1())*(Math.PI/180),b=this.vectorHelpers.create(Math.sin(b),-Math.cos(b)),d=this.speed+this.speedRandom*this.RANDM1TO1();a.direction=this.vectorHelpers.multiply(b,d);a.size=this.size+this.sizeRandom*this.RANDM1TO1();a.size=0>a.size?0:~~a.size;a.timeToLive=this.lifeSpan+this.lifeSpanRandom*this.RANDM1TO1();a.sharpness=this.sharpness+this.sharpnessRandom*this.RANDM1TO1();a.sharpness=100<a.sharpness?100:0>a.sharpness?0:a.sharpness;a.sizeSmall=
~~(a.size/200*a.sharpness);b=[this.startColour[0]+this.startColourRandom[0]*this.RANDM1TO1(),this.startColour[1]+this.startColourRandom[1]*this.RANDM1TO1(),this.startColour[2]+this.startColourRandom[2]*this.RANDM1TO1(),this.startColour[3]+this.startColourRandom[3]*this.RANDM1TO1()];d=[this.endColour[0]+this.endColourRandom[0]*this.RANDM1TO1(),this.endColour[1]+this.endColourRandom[1]*this.RANDM1TO1(),this.endColour[2]+this.endColourRandom[2]*this.RANDM1TO1(),this.endColour[3]+this.endColourRandom[3]*
this.RANDM1TO1()];a.colour=b;a.deltaColour[0]=(d[0]-b[0])/a.timeToLive;a.deltaColour[1]=(d[1]-b[1])/a.timeToLive;a.deltaColour[2]=(d[2]-b[2])/a.timeToLive;a.deltaColour[3]=(d[3]-b[3])/a.timeToLive},update:function(){if(this.active&&0<this.emissionRate){var a=1/this.emissionRate;for(this.emitCounter++;this.particleCount<this.maxParticles&&this.emitCounter>a;)this.addParticle(),this.emitCounter-=a;this.elapsedFrames++;-1!=this.duration&&this.duration<this.elapsedFrames&&this.stop()}this.particleIndex=
0;this.register=[];for(var b;this.particleIndex<this.particleCount;){a=this.particles[this.particleIndex];if(0<a.timeToLive){a.direction=this.vectorHelpers.add(a.direction,this.gravity);a.position=this.vectorHelpers.add(a.position,a.direction);a.position=this.vectorHelpers.add(a.position,this.viewportDelta);this.jitter&&(a.position.x+=this.jitter*this.RANDM1TO1(),a.position.y+=this.jitter*this.RANDM1TO1());a.timeToLive--;var d=a.colour[0]+=a.deltaColour[0],f=a.colour[1]+=a.deltaColour[1],e=a.colour[2]+=
a.deltaColour[2],g=a.colour[3]+=a.deltaColour[3];b=[];b.push("rgba("+(255<d?255:0>d?0:~~d));b.push(255<f?255:0>f?0:~~f);b.push(255<e?255:0>e?0:~~e);b.push((1<g?1:0>g?0:g.toFixed(2))+")");a.drawColour=b.join(",");this.fastMode||(b[3]="0)",a.drawColourEnd=b.join(","));this.particleIndex++}else this.particleIndex!=this.particleCount-1&&(this.particles[this.particleIndex]=this.particles[this.particleCount-1]),this.particleCount--;b={};b._x=~~a.position.x;b._y=~~a.position.y;b._w=a.size;b._h=a.size;this.register.push(b)}},
stop:function(){this.active=!1;this.emitCounter=this.elapsedFrames=0},render:function(a){for(var c=0,d=this.particleCount;c<d;c++){var f=this.particles[c],e=f.size,g=e>>1;if(!(0>f.position.x+e||0>f.position.y+e||f.position.x-e>b.viewport.width||f.position.y-e>b.viewport.height)){var h=~~f.position.x,n=~~f.position.y;this.fastMode?a.fillStyle=f.drawColour:(g=a.createRadialGradient(h+g,n+g,f.sizeSmall,h+g,n+g,g),g.addColorStop(0,f.drawColour),g.addColorStop(.9,f.drawColourEnd),a.fillStyle=g);a.fillRect(h,
n,e,e)}}},particle:function(a){this.position=a.create(0,0);this.direction=a.create(0,0);this.timeToLive=this.sizeSmall=this.size=0;this.colour=[];this.drawColour="";this.deltaColour=[];this.sharpness=0},vectorHelpers:{create:function(a,b){return{x:a,y:b}},multiply:function(a,b){a.x*=b;a.y*=b;return a},add:function(a,b){a.x+=b.x;a.y+=b.y;return a}}}});b.extend({audio:{sounds:{},supported:{},codecs:{ogg:'audio/ogg; codecs="vorbis"',wav:'audio/wav; codecs="1"',webma:'audio/webm; codecs="vorbis"',mp3:'audio/mpeg; codecs="mp3"',
m4a:'audio/mp4; codecs="mp4a.40.2"'},volume:1,muted:!1,paused:!1,canPlay:function(){var a=this.audioElement(),b,d;for(d in this.codecs)b=a.canPlayType(this.codecs[d]),this.supported[d]=""!==b&&"no"!==b?!0:!1},audioElement:function(){return"undefined"!==typeof Audio?new Audio(""):t.createElement("audio")},add:function(a,c){b.support.audio=!!this.audioElement().canPlayType;if(b.support.audio){this.canPlay();var d,f,e;if(1===arguments.length&&"object"===typeof a)for(var g in a)for(var h in a[g])d=this.audioElement(),
d.id=g,d.preload="auto",d.volume=b.audio.volume,e=a[g][h],f=e.substr(e.lastIndexOf(".")+1).toLowerCase(),this.supported[f]&&(d.src=e,b.asset(e,d),this.sounds[g]={obj:d,played:0,volume:b.audio.volume});if("string"===typeof a&&(d=this.audioElement(),d.id=a,d.preload="auto",d.volume=b.audio.volume,"string"===typeof c&&(f=c.substr(c.lastIndexOf(".")+1).toLowerCase(),this.supported[f]&&(d.src=c,b.asset(c,d),this.sounds[a]={obj:d,played:0,volume:b.audio.volume})),"object"===typeof c))for(h in c)d=this.audioElement(),
d.id=a,d.preload="auto",d.volume=b.audio.volume,e=c[h],f=e.substr(e.lastIndexOf(".")+1).toLowerCase(),this.supported[f]&&(d.src=e,b.asset(e,d),this.sounds[a]={obj:d,played:0,volume:b.audio.volume})}},play:function(a,c,d){if(0!=c&&b.support.audio&&this.sounds[a]){var f=this.sounds[a];f.volume=f.obj.volume=d||b.audio.volume;f.obj.currentTime&&(f.obj.currentTime=0);this.muted&&(f.obj.volume=0);f.obj.play();f.played++;f.obj.addEventListener("ended",function(){if(f.played<c||-1==c)this.currentTime&&(this.currentTime=
0),this.play(),f.played++},!0)}},stop:function(a){if(b.support.audio){var c;if(!a)for(var d in this.sounds)c=this.sounds[d],c.obj.paused||c.obj.pause();this.sounds[a]&&(c=this.sounds[a],c.obj.paused||c.obj.pause())}},_mute:function(a){if(b.support.audio){var c,d;for(d in this.sounds)c=this.sounds[d],c.obj.volume=a?0:c.volume;this.muted=a}},toggleMute:function(){this.muted?this._mute(!1):this._mute(!0)},mute:function(){this._mute(!0)},unmute:function(){this._mute(!1)},pause:function(a){b.support.audio&&
a&&this.sounds[a]&&(a=this.sounds[a],a.obj.paused||a.obj.pause())},unpause:function(a){b.support.audio&&a&&this.sounds[a]&&(a=this.sounds[a],a.obj.paused&&a.obj.play())},togglePause:function(a){b.support.audio&&a&&this.sounds[a]&&(a=this.sounds[a],a.obj.paused?a.obj.play():a.obj.pause())}}});b.c("Text",{_text:"",_textFont:{type:"",weight:"",size:"",family:""},ready:!0,init:function(){this.requires("2D");this.bind("Draw",function(a){var b=this._textFont.type+" "+this._textFont.weight+" "+this._textFont.size+
" "+this._textFont.family;if("DOM"===a.type){a=this._element;var d=a.style;d.color=this._textColor;d.font=b;a.innerHTML=this._text}else"canvas"===a.type&&(a=a.ctx,d=null,a.save(),a.fillStyle=this._textColor||"rgb(0,0,0)",a.font=b,a.translate(this.x,this.y+this.h),a.fillText(this._text,0,0),d=a.measureText(this._text),this._w=d.width,a.restore())})},text:function(a){if("undefined"===typeof a||null===a)return this._text;this._text="function"==typeof a?a.call(this):a;this.trigger("Change");return this},
textColor:function(a,c){this._strength=c;this._textColor=b.toRGB(a,this._strength);this.trigger("Change");return this},textFont:function(a,b){if(1===arguments.length){if("string"===typeof a)return this._textFont[a];if("object"===typeof a)for(propertyKey in a)this._textFont[propertyKey]=a[propertyKey]}else this._textFont[a]=b;this.trigger("Change");return this}});b.extend({assets:{},asset:function(a,c){if(1===arguments.length)return b.assets[a];b.assets[a]||(b.assets[a]=c,this.trigger("NewAsset",{key:a,
value:c}))},image_whitelist:["jpg","jpeg","gif","png","svg"],load:function(a,c,d,f){function e(){var a=this.src;this.removeEventListener&&this.removeEventListener("canplaythrough",e,!1);++q;d&&d({loaded:q,total:p,percent:q/p*100,src:a});q===p&&c&&c()}function g(){var a=this.src;f&&f({loaded:q,total:p,percent:q/p*100,src:a});q++;q===p&&c&&c()}for(var h=0,n=a.length,k,m,p=n,q=0,r="";h<n;++h){k=a[h];r=k.substr(k.lastIndexOf(".")+1,3).toLowerCase();m=b.asset(k)||null;if(b.support.audio&&b.audio.supported[r])m||
(r=k.substr(k.lastIndexOf("/")+1).toLowerCase(),m=b.audio.audioElement(),m.id=r,m.src=k,m.preload="auto",m.volume=b.audio.volume,b.asset(k,m),b.audio.sounds[r]={obj:m,played:0}),m.addEventListener&&m.addEventListener("canplaythrough",e,!1);else if(0<=b.image_whitelist.indexOf(r))m||(m=new Image,b.asset(k,m)),m.onload=e,m.src=k;else{p--;continue}m.onerror=g}},modules:function(a,b,d){2===arguments.length&&"object"===typeof a&&(d=b,b=a,a="http://cdn.craftycomponents.com");var f=function(){function a(b,
c,d){d=0;for(j=b.length;d<j;++d)if(!c(b[d]))return!1;return 1}function b(c,d){a(c,function(a){return!d(a)})}function c(e,f,g){function q(a){return a.call?a():s[a]}function r(){if(!--A){s[z]=1;v&&v();for(var c in u)a(c.split("|"),q)&&!b(u[c],q)&&(u[c]=[])}}e=e.push?e:[e];var t=f&&f.call,v=t?f:g,z=t?e.join(""):f,A=e.length;setTimeout(function(){b(e,function(a){if(x[a])return 2==x[a]&&r();x[a]=1;d(!h.test(a)&&y?y+a+".js":a,r)})},0);return c}function d(a,b){var c=f.createElement("script"),e=!1;c.onload=
c.onerror=c.onreadystatechange=function(){c.readyState&&!/^c|loade/.test(c.readyState)||e||(c.onload=c.onreadystatechange=null,e=1,x[a]=2,b())};c.async=1;c.src=a;g.insertBefore(c,g.firstChild)}var e=this,f=t,g=f.getElementsByTagName("head")[0],h=/^https?:\/\//,r=e.$script,s={},u={},y,x={};!f.readyState&&f.addEventListener&&(f.addEventListener("DOMContentLoaded",function C(){f.removeEventListener("DOMContentLoaded",C,!1);f.readyState="complete"},!1),f.readyState="loading");c.get=d;c.order=function(a,
b,d){(function D(e){e=a.shift();a.length?c(e,D):c(e,b,d)})()};c.path=function(a){y=a};c.ready=function(d,e,f){d=d.push?d:[d];var g=[];!b(d,function(a){s[a]||g.push(a)})&&a(d,function(a){return s[a]})?e():!function(a){u[a]=u[a]||[];u[a].push(e);f&&f(g)}(d.join("|"));return c};c.noConflict=function(){e.$script=r;return this};return c}(),e=[],g=/^(https?|file):\/\//,h;for(h in b)g.test(h)?e.push(h):e.push(a+"/"+h.toLowerCase()+"-"+b[h].toLowerCase()+".js");f(e,function(){d&&d()})}});b.math={abs:function(a){return 0>
a?-a:a},amountOf:function(a,b,d){return b<d?(a-b)/(d-b):(a-d)/(b-d)},clamp:function(a,b,d){return a>d?d:a<b?b:a},degToRad:function(a){return a*Math.PI/180},distance:function(a,c,d,f){a=b.math.squaredDistance(a,c,d,f);return Math.sqrt(parseFloat(a))},lerp:function(a,b,d){return a+(b-a)*d},negate:function(a){return Math.random()<a?-1:1},radToDeg:function(a){return 180*a/Math.PI},randomElementOfArray:function(a){return a[Math.floor(a.length*Math.random())]},randomInt:function(a,b){return a+Math.floor((1+
b-a)*Math.random())},randomNumber:function(a,b){return a+(b-a)*Math.random()},squaredDistance:function(a,b,d,f){return(a-d)*(a-d)+(b-f)*(b-f)},withinRange:function(a,b,d){return a>=b&&a<=d}};b.math.Vector2D=function(){function a(b,d){if(b instanceof a)this.x=b.x,this.y=b.y;else if(2===arguments.length)this.x=b,this.y=d;else if(0<arguments.length)throw"Unexpected number of arguments for Vector2D()";}a.prototype.x=0;a.prototype.y=0;a.prototype.add=function(a){this.x+=a.x;this.y+=a.y;return this};a.prototype.angleBetween=
function(a){return Math.atan2(this.x*a.y-this.y*a.x,this.x*a.x+this.y*a.y)};a.prototype.angleTo=function(a){return Math.atan2(a.y-this.y,a.x-this.x)};a.prototype.clone=function(){return new a(this)};a.prototype.distance=function(a){return Math.sqrt((a.x-this.x)*(a.x-this.x)+(a.y-this.y)*(a.y-this.y))};a.prototype.distanceSq=function(a){return(a.x-this.x)*(a.x-this.x)+(a.y-this.y)*(a.y-this.y)};a.prototype.divide=function(a){this.x/=a.x;this.y/=a.y;return this};a.prototype.dotProduct=function(a){return this.x*
a.x+this.y*a.y};a.prototype.equals=function(b){return b instanceof a&&this.x==b.x&&this.y==b.y};a.prototype.getNormal=function(b){return void 0===b?new a(-this.y,this.x):(new a(b.y-this.y,this.x-b.x)).normalize()};a.prototype.isZero=function(){return 0===this.x&&0===this.y};a.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};a.prototype.magnitudeSq=function(){return this.x*this.x+this.y*this.y};a.prototype.multiply=function(a){this.x*=a.x;this.y*=a.y;return this};a.prototype.negate=
function(){this.x=-this.x;this.y=-this.y;return this};a.prototype.normalize=function(){var a=Math.sqrt(this.x*this.x+this.y*this.y);0===a?(this.x=1,this.y=0):(this.x/=a,this.y/=a);return this};a.prototype.scale=function(a,b){void 0===b&&(b=a);this.x*=a;this.y*=b;return this};a.prototype.scaleToMagnitude=function(a){a/=this.magnitude();this.x*=a;this.y*=a;return this};a.prototype.setValues=function(b,d){b instanceof a?(this.x=b.x,this.y=b.y):(this.x=b,this.y=d);return this};a.prototype.subtract=function(a){this.x-=
a.x;this.y-=a.y;return this};a.prototype.toString=function(){return"Vector2D("+this.x+", "+this.y+")"};a.prototype.translate=function(a,b){void 0===b&&(b=a);this.x+=a;this.y+=b;return this};a.tripleProduct=function(a,d,f){var e=a.dotProduct(f);f=d.dotProduct(f);return new b.math.Vector2D(d.x*e-a.x*f,d.y*e-a.y*f)};return a}();b.math.Matrix2D=function(){Matrix2D=function(a,b,d,f,e,g){if(a instanceof Matrix2D)this.a=a.a,this.b=a.b,this.c=a.c,this.d=a.d,this.e=a.e,this.f=a.f;else if(6===arguments.length)this.a=
a,this.b=b,this.c=d,this.d=f,this.e=e,this.f=g;else if(0<arguments.length)throw"Unexpected number of arguments for Matrix2D()";};Matrix2D.prototype.a=1;Matrix2D.prototype.b=0;Matrix2D.prototype.c=0;Matrix2D.prototype.d=1;Matrix2D.prototype.e=0;Matrix2D.prototype.f=0;Matrix2D.prototype.apply=function(a){var b=a.x;a.x=b*this.a+a.y*this.c+this.e;a.y=b*this.b+a.y*this.d+this.f;return a};Matrix2D.prototype.clone=function(){return new Matrix2D(this)};Matrix2D.prototype.combine=function(a){var b=this.a;
this.a=b*a.a+this.b*a.c;this.b=b*a.b+this.b*a.d;b=this.c;this.c=b*a.a+this.d*a.c;this.d=b*a.b+this.d*a.d;b=this.e;this.e=b*a.a+this.f*a.c+a.e;this.f=b*a.b+this.f*a.d+a.f;return this};Matrix2D.prototype.equals=function(a){return a instanceof Matrix2D&&this.a==a.a&&this.b==a.b&&this.c==a.c&&this.d==a.d&&this.e==a.e&&this.f==a.f};Matrix2D.prototype.determinant=function(){return this.a*this.d-this.b*this.c};Matrix2D.prototype.invert=function(){var a=this.determinant();if(0!==a){var b=this.a,d=this.b,
f=this.c,e=this.d,g=this.e,h=this.f;this.a=e/a;this.b=-d/a;this.c=-f/a;this.d=b/a;this.e=(f*h-g*e)/a;this.f=(g*d-b*h)/a}return this};Matrix2D.prototype.isIdentity=function(){return 1===this.a&&0===this.b&&0===this.c&&1===this.d&&0===this.e&&0===this.f};Matrix2D.prototype.isInvertible=function(){return 0!==this.determinant()};Matrix2D.prototype.preRotate=function(a){var b=Math.cos(a);a=Math.sin(a);var d=this.a;this.a=b*d-a*this.b;this.b=a*d+b*this.b;d=this.c;this.c=b*d-a*this.d;this.d=a*d+b*this.d;
return this};Matrix2D.prototype.preScale=function(a,b){void 0===b&&(b=a);this.a*=a;this.b*=b;this.c*=a;this.d*=b;return this};Matrix2D.prototype.preTranslate=function(a,b){"number"===typeof a?(this.e+=a,this.f+=b):(this.e+=a.x,this.f+=a.y);return this};Matrix2D.prototype.rotate=function(a){var b=Math.cos(a);a=Math.sin(a);var d=this.a;this.a=b*d-a*this.b;this.b=a*d+b*this.b;d=this.c;this.c=b*d-a*this.d;this.d=a*d+b*this.d;d=this.e;this.e=b*d-a*this.f;this.f=a*d+b*this.f;return this};Matrix2D.prototype.scale=
function(a,b){void 0===b&&(b=a);this.a*=a;this.b*=b;this.c*=a;this.d*=b;this.e*=a;this.f*=b;return this};Matrix2D.prototype.setValues=function(a,b,d,f,e,g){a instanceof Matrix2D?(this.a=a.a,this.b=a.b,this.c=a.c,this.d=a.d,this.e=a.e,this.f=a.f):(this.a=a,this.b=b,this.c=d,this.d=f,this.e=e,this.f=g);return this};Matrix2D.prototype.toString=function(){return"Matrix2D(["+this.a+", "+this.c+", "+this.e+"] ["+this.b+", "+this.d+", "+this.f+"] [0, 0, 1])"};Matrix2D.prototype.translate=function(a,b){"number"===
typeof a?(this.e+=this.a*a+this.c*b,this.f+=this.b*a+this.d*b):(this.e+=this.a*a.x+this.c*a.y,this.f+=this.b*a.x+this.d*a.y);return this};return Matrix2D}();b.c("Delay",{init:function(){this._delays=[];this.bind("EnterFrame",function(){var a=(new Date).getTime(),b;for(b in this._delays){var d=this._delays[b];!d.triggered&&d.start+d.delay+d.pause<a&&(d.triggered=!0,d.func.call(this))}});this.bind("Pause",function(){var a=(new Date).getTime(),b;for(b in this._delays)this._delays[b].pauseBuffer=a});
this.bind("Unpause",function(){var a=(new Date).getTime(),b;for(b in this._delays){var d=this._delays[b];d.pause+=a-d.pauseBuffer}})},delay:function(a,b){return this._delays.push({start:(new Date).getTime(),func:a,delay:b,triggered:!1,pauseBuffer:0,pause:0})}})});